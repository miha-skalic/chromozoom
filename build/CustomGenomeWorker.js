(function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i})({1:[function(e,t,n){t.exports=function(t){function u(e,t){if(e===!1)return;this._parsed=!1,this._format=e&&e.toLowerCase()||"chromsizes";var r=this.format();if(r===null)throw new Error("Unsupported genome format '"+r+"' encountered");this.opts=n.extend({},i(this.constructor.defaults),i(r.defaults||{})),this.metadata=t,this.data={sequence:""},this.canGetSequence=!1,r.init&&r.init.call(this)}var n=e("../underscore.min.js"),r=e("./genome-formats/utils/utils.js"),i=r.deepClone,s=r.log10,o=r.roundToPlaces;return u.defaults={genome:"_blank",species:"Blank Genome",assemblyDate:"",tileDir:null,overzoomBppps:[],ntsBelow:[1,.1],availTracks:[{fh:{},n:"ruler",s:["dense"],h:25}],genomeSize:0,chrLengths:{},chrOrder:[],chrBands:null,tileWidth:1e3,subdirForBpppsUnder:330,ideogramsAbove:1e3,maxNtRequest:2e4,tracks:[{n:"ruler"}],trackDesc:{ruler:{cat:"Mapping and Sequencing Tracks",sm:"Base Position"}},bppps:[],bpppNumbersBelow:[],initZoom:null},u.formats={chromsizes:e("./genome-formats/chromsizes.js"),fasta:e("./genome-formats/fasta.js"),genbank:e("./genome-formats/genbank.js"),embl:null},u.prototype.parse=function(){this.format().parse.apply(this,n.toArray(arguments)),this.setGenomeString(),this._parsed=!0},u.prototype.format=function(e){var t=this;n.isUndefined(e)&&(e=t._format);var r=function(){return n.extend(this,t.constructor.formats[e]),this};return r.prototype=t,new r},u.prototype.setGenomeString=function(){var e=this,t=e.opts,r=["file","igb","acc","url","ucsc"],i=n.find(r,function(t){return!n.isUndefined(e.metadata[t])}),s=[];i?t.genome=i+":"+e.metadata[i]:(s=["custom"+(e.metadata.name?":"+e.metadata.name:"")],n.each(t.chrOrder,function(e){s.push(e+":"+t.chrLengths[e])}),t.genome=s.join("|"))},u.prototype.setBppps=function(e){e=e||{};var t=this.opts,n=e.width*.6||1e3,r=Math.round(t.genomeSize/n),i=e.lowestBppp||.1,u=100,a=[],f=0,l;while(r>=i&&f<u)a.push(r),l=o(s(r),4),r=Math.ceil(l)-l<.481?3.3*Math.pow(10,Math.ceil(l)-1):Math.pow(10,Math.floor(l)),f++;t.bppps=a,t.bpppNumbersBelow=a.slice(0,2),t.initZoom=a[0]},u.prototype.options=function(e){if(!this._parsed)throw"Cannot generate options before parsing the genome file";return this.setBppps(e),this.opts.custom=this,this.opts},u.prototype.getSequence=function(e,t,r){var i=this.data.sequence.substring(e-1,t-1);return n.isFunction(r)?r(i):i},u.prototype.getSequenceAsync=function(){t.CustomGenomes.async(this,"getSequence",arguments,[this.id])},u}},{"../underscore.min.js":25,"./genome-formats/chromsizes.js":6,"./genome-formats/fasta.js":7,"./genome-formats/genbank.js":8,"./genome-formats/utils/utils.js":9}],2:[function(e,t,n){var r=self;e("./jquery.nodom.min.js")(r),r._=e("../underscore.min.js"),e("./CustomGenomes.js")(r);if(!r.console||!r.console.log)r.console=r.console||{},r.console.log=function(){r.postMessage({log:JSON.stringify(_.toArray(arguments))})};var i={_genomes:[],_throwErrors:!1,parse:function(e,t){var n=this,r=CustomGenomes.parse(e,t),i;return r.id=n._genomes.push(r)-1,i=_.extend({},r),delete i.data,i},options:function(){var e=_.toArray(arguments),t=_.first(e),n=this._genomes[t];return n.options.apply(n,_.rest(e))},getSequence:function(){var e=_.toArray(arguments),t=_.first(e),n=this._genomes[t];return n.getSequence.apply(n,_.rest(e))},throwErrors:function(e){this._throwErrors=e}};r.addEventListener("message",function(e){var t=e.data,n=function(e){r.postMessage({id:t.id,ret:JSON.stringify(e||null)})},s;if(i._throwErrors)s=i[t.op].apply(i,t.args.concat(n));else try{s=i[t.op].apply(i,t.args.concat(n))}catch(o){r.postMessage({id:t.id,error:JSON.stringify({message:o.message})})}_.isUndefined(s)||n(s)})},{"../underscore.min.js":25,"./CustomGenomes.js":3,"./jquery.nodom.min.js":10}],3:[function(e,t,n){t.exports=function(t){var n=e("../underscore.min.js");t.CustomTracks||e("./CustomTracks.js")(t);var r=e("./CustomGenome")(t),i={parse:function(e,t){t=t||{},t.format||(t.format=this.guessFormat(e));var n=new r(t.format,t);return n.parse(e),n},blank:function(){var e=new r("chromsizes",{species:"Blank Genome"});return e.parse("blank	50000"),e},guessFormat:function(e){return e.substring(0,5)=="LOCUS"?"genbank":/^[A-Z]{2} {3}/.test(e)?"embl":/^[>;]/.test(e)?"fasta":"fasta"},error:function(e){console.log(e)},_workerScript:"build/CustomGenomeWorker.js",_disableWorkers:!1,worker:t.CustomTracks.worker,async:t.CustomTracks.async,parseAsync:function(){this.async(this,"parse",arguments,[],function(e){return n.extend(new r(!1),e,{getSequence:function(){r.prototype.getSequenceAsync.apply(this,arguments)}})})}};t.CustomGenomes=i}},{"../underscore.min.js":25,"./CustomGenome":1,"./CustomTracks.js":5}],4:[function(e,t,n){t.exports=function(t){function s(e,t){if(!e)return;this._type=e.type&&e.type.toLowerCase()||"bed";var r=this.type();if(r===null)throw new Error("Unsupported track type '"+e.type+"' encountered on line "+e.lineNum);this.opts=n.extend({},this.constructor.defaults,r.defaults||{},e),n.extend(this,{browserOpts:t,stretchHeight:!1,heights:{},sizes:["dense"],mapSizes:[],areas:{},noAreaLabels:!1,expectsSequence:!1}),this.init()}var n=e("../underscore.min.js"),r=e("./track-types/utils/utils.js"),i=r.parseInt10;return s.defaults={name:"User Track",description:"User Supplied Track",color:"0,0,0"},s.types={bed:e("./track-types/bed.js"),featuretable:e("./track-types/featuretable.js"),bedgraph:e("./track-types/bedgraph.js"),wiggle_0:e("./track-types/wiggle_0.js"),vcftabix:e("./track-types/vcftabix.js"),bigbed:e("./track-types/bigbed.js"),bam:e("./track-types/bam.js"),bigwig:e("./track-types/bigwig.js")},s.types.beddetail=n.clone(s.types.bed),s.types.beddetail.defaults=n.extend({},s.types.beddetail.defaults,{detail:!0}),n.each(["init","parse","render","renderSequence","prerender"],function(e){s.prototype[e]=function(){var t=n.toArray(arguments),r=this.type();return r[e]?r[e].apply(this,t):!1}}),s.prototype.loadOpts=function(e){var t=this.type(),n=this.opts;e.find(".custom-opts-form").hide(),e.find(".custom-opts-form."+this._type).show(),e.find(".custom-name").text(n.name),e.find(".custom-desc").text(n.description),e.find(".custom-format").text(this._type),e.find("[name=color]").val(n.color).change(),t.loadOpts&&t.loadOpts.call(this,e),e.find(".enabler").change()},s.prototype.saveOpts=function(e){var n=this.type(),r=this.opts;r.color=e.find("[name=color]").val(),this.validateColor(r.color)||(r.color="0,0,0"),n.saveOpts&&n.saveOpts.call(this,e),this.applyOpts(),t.CustomTracks.worker()&&this.applyOptsAsync()},s.prototype.applyOpts=function(e){var t=this.type();e&&(this.opts=e),t.applyOpts&&t.applyOpts.call(this)},s.prototype.erase=function(e){var t=this,n=e.getContext&&e.getContext("2d");n&&n.clearRect(0,0,e.width,e.height)},s.prototype.type=function(e){return n.isUndefined(e)&&(e=this._type),this.constructor.types[e]||null},s.prototype.warn=function(e){if(this.opts.strict)throw new Error(e);this.warnings||(this.warnings=[]),this.warnings.push(e)},s.prototype.isOn=function(e){return/^(on|yes|true|t|y|1)$/i.test(e.toString())},s.prototype.chrList=function(){return this._chrList||(this._chrList=n.sortBy(n.map(this.browserOpts.chrPos,function(e,t){return[e,t]}),function(e){return e[0]})),this._chrList},s.prototype.chrAt=function(e){var t=this.chrList(),r=n.sortedIndex(t,[e],function(e){return e[0]}),i=r>0?t[r-1][1]:null;return{i:r-1,c:i,p:e-this.browserOpts.chrPos[i]}},s.prototype.chrRange=function(e,t){var r=this.browserOpts.chrLengths,i=this.chrAt(e),s=this.chrAt(t),o;return i.c&&i.i===s.i?[i.c+":"+i.p+"-"+s.p]:(o=n.map(this.chrList().slice(i.i+1,s.i),function(e){return e[1]+":1-"+r[e[1]]}),i.c&&o.unshift(i.c+":"+i.p+"-"+r[i.c]),s.c&&o.push(s.c+":1-"+s.p),o)},s.prototype.prerenderAsync=function(){t.CustomTracks.async(this,"prerender",arguments,[this.id])},s.prototype.applyOptsAsync=function(){t.CustomTracks.async(this,"applyOpts",[this.opts,function(){}],[this.id])},s.prototype.ajaxDir=function(){return(t.HTMLDocument?"":"../")+this.browserOpts.ajaxDir},s.prototype.rgbToHsl=function(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n),s,o,u=(r+i)/2;if(r==i)s=o=0;else{var a=r-i;o=u>.5?a/(2-r-i):a/(r+i);switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4}s/=6}return[s,o,u]},s.prototype.hslToRgb=function(e,t,n){var r,i,s;if(t==0)r=i=s=n;else{function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var u=n<.5?n*(1+t):n+t-n*t,a=2*n-u;r=o(a,u,e+1/3),i=o(a,u,e),s=o(a,u,e-1/3)}return[r*255,i*255,s*255]},s.prototype.validateColor=function(e){var t=e.match(/(\d+),(\d+),(\d+)/);return t?(t.shift(),n.all(n.map(t,i),function(e){return e>=0&&e<=255})):!1},s}},{"../underscore.min.js":25,"./track-types/bam.js":11,"./track-types/bed.js":12,"./track-types/bedgraph.js":13,"./track-types/bigbed.js":14,"./track-types/bigwig.js":15,"./track-types/featuretable.js":16,"./track-types/utils/utils.js":22,"./track-types/vcftabix.js":23,"./track-types/wiggle_0.js":24}],5:[function(e,t,n){t.exports=function(t){var n=e("../underscore.min.js"),r=e("./track-types/utils/utils.js"),i=r.parseDeclarationLine,s=e("./CustomTrack.js")(t),o={parse:function(e,t){function l(){u.parse(o)&&r.push(u)}var r=[],o=[],u,a,f;return typeof e=="string"&&(e=[e]),r.browser={},n.each(e,function(e){n.each(e.split("\n"),function(e,n){if(!/^#/.test(e))if(/^browser\s+/.test(e)){f=e.match(/^browser\s+(\w+)\s+(\S*)/);if(!f)throw new Error("Could not parse browser line found at line "+(n+1));r.browser[f[1]]=f[2]}else if(/^track\s+/i.test(e)){u&&l(),a=i(e,/^track\s+/i);if(!a)throw new Error("Could not parse track line found at line "+(n+1));a.lineNum=n+1,u=new s(a,t),o=[]}else if(/\S/.test(e)){if(!u)throw new Error("Found data on line "+(n+1)+" but no preceding track definition");o.push(e)}})}),u&&l(),r},parseDeclarationLine:i,error:function(e){console.log(e)},_workerScript:"build/CustomTrackWorker.js",_disableWorkers:!1,worker:function(){var e=this,n=[];return!e._worker&&t.Worker&&(e._worker=new t.Worker(e._workerScript),e._worker.addEventListener("error",function(t){e.error(t)},!1),e._worker.addEventListener("message",function(t){if(t.data.log){console.log(JSON.parse(t.data.log));return}if(t.data.error){t.data.id&&(n[t.data.id]=null),e.error(JSON.parse(t.data.error));return}n[t.data.id](JSON.parse(t.data.ret)),n[t.data.id]=null}),e._worker.call=function(e,t,r){var i=n.push(r)-1;this.postMessage({op:e,id:i,args:t})},e._worker.throwErrors=function(e){this.postMessage({op:"throwErrors",args:[e]})}),e._disableWorkers?null:e._worker},async:function(e,t,r,i,s){r=n.toArray(r),s=s||n.identity;var o=n.initial(r),u=n.last(r),a=this.worker();if(!a)return u(e[t].apply(e,o));Array.prototype.unshift.apply(o,i),a.call(t,o,function(e){u(s(e))})},parseAsync:function(){this.async(this,"parse",arguments,[],function(e){return n.map(e,function(e){return n.extend(new s,e,{prerender:function(){s.prototype.prerenderAsync.apply(this,arguments)}})})})}};t.CustomTracks=o}},{"../underscore.min.js":25,"./CustomTrack.js":4,"./track-types/utils/utils.js":22}],6:[function(e,t,n){(function(n){var r=e("./utils/utils.js"),i=r.parseInt10,s=r.strip,o=r.optsAsTrackLine,u={init:function(){var e=this,t=e.metadata,n=e.opts;n.species=t.species||"Custom Genome",n.assemblyDate=t.assemblyDate||"",t.tracks&&e.format().createTracks(t.tracks)},createTracks:function(e){var t=this,r=t.opts;_.each(e,function(e){var t;e.lines=e.lines||[],t=/^track\s+/i.test(e.lines[0])?n.CustomTracks.parseDeclarationLine(e.lines.shift()):{},e.lines.unshift("track "+o(_.extend(t,e.opts,{name:e.name,type:e.type}))+"\n"),r.availTracks.push({fh:{},n:e.name,s:["dense","squish","pack"],h:15,m:["pack"],customData:e.lines}),r.tracks.push({n:e.name}),r.trackDesc[e.name]={cat:"Feature Tracks",sm:e.name,lg:e.description||e.name}})},parse:function(e){var t=e.split("\n"),n=this.opts;_.each(t,function(e,t){var r=s(e).split(/\s+/,2),o=r[0],u=i(r[1]);if(_.isNaN(u))return;n.chrOrder.push(o),n.chrLengths[o]=u,n.genomeSize+=u})}};t.exports=u}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./utils/utils.js":9}],7:[function(e,t,n){var r=e("./utils/utils.js"),i=r.ensureUnique,s={init:function(){var e=this,t=e.metadata,n=e.opts;e.data={}},parse:function(e){var t=e.split("\n"),n=this,r=n.opts,s=null,o=1,u=[];n.data.sequence=[],_.each(t,function(e,t){var o=e.match(/^[>;](.+)/),u=e.replace(/\s+/g,"");o?(s=o[1].replace(/^\s+|\s+$/g,""),s.length||(s="unnamedChr"),s=i(s,r.chrLengths),r.chrOrder.push(s)):(n.data.sequence.push(u),r.chrLengths[s]=(r.chrLengths[s]||0)+u.length,r.genomeSize+=u.length)}),n.data.sequence=n.data.sequence.join(""),n.canGetSequence=!0}};t.exports=s},{"./utils/utils.js":9}],8:[function(e,t,n){var r=e("./utils/utils.js"),i=r.parseInt10,s=r.strip,o=r.topTagsAsArray,u=r.subTagsAsArray,a=r.fetchField,f=r.getTag,l=r.ensureUnique,c={init:function(){this.tagSize=12,this.featureTagSize=21,this.data={contigs:[],trackLines:{source:[],genes:[],other:[]}}},parseLocus:function(e){var t=e.orig.locus;t&&(t.length>75?(e.entryId=s(t.substring(12,28)),e.length=i(t.substring(29,40)),e.strand=s(t.substring(44,47)),e.natype=s(t.substring(47,53)),e.circular=s(t.substring(55,63)),e.division=s(t.substring(63,67)),e.date=s(t.substring(68,79))):(e.entryId=s(t.substring(12,22)),e.length=i(t.substring(22,30)),e.strand=s(t.substring(33,36)),e.natype=s(t.substring(36,40)),e.circular=s(t.substring(42,52)),e.division=s(t.substring(52,55)),e.date=s(t.substring(62,73))))},parseHeaderFields:function(e){var t=this.tagSize,n={simple:["definition","accession","version"],deep:["source"]};_.each(n.simple,function(n){if(!e.orig[n]){e[n]=null;return}e[n]=a(e.orig[n],t)}),_.each(n.deep,function(n){var r=[],i;if(!e.orig[n]){e[n]=null;return}i=e.orig[n].replace(/\n([A-Za-z\/\*])/g,"\n$1").split(""),_.each(i,function(e){var n=u(e,t),i=a(n.shift(),t),s={_name:i};_.each(n,function(e){var n=f(e,t);s[n]=a(e,t)}),r.push(s)}),e[n]=r})},parseFeatureTable:function(e,t){var n=this,r=n.tagSize,i=n.featureTagSize,s=["features"],o=["cds","gene","mrna","exon","intron"],a="ACCESSION   "+e+"\n";if(t.orig.features){var l=u(t.orig.features,r);n.data.trackLines.source.push(a),n.data.trackLines.genes.push(a),n.data.trackLines.other.push(a),_.each(l,function(e){var t=f(e,i);if(s.indexOf(t)!==-1)return;t==="source"?n.data.trackLines.source.push(e):o.indexOf(t)!==-1?n.data.trackLines.genes.push(e):n.data.trackLines.other.push(e)})}},parseSequence:function(e){return e.orig.origin?e.orig.origin.replace(/^origin.*|\n[ 0-9]{10}| /ig,""):Array(e.length).join("n")},createTracksFromFeatures:function(){var e=this,t=e.opts,n=[["source","Sources","Regions annotated by source organism or specimen"],["genes","Gene annotations","CDS and gene features"],["other","Other annotations","tRNAs and other features"]];_.each(n,function(n){var r=n[0],i=n[1],s=n[2],o=[];e.data.trackLines[r].length>0&&e.data.trackLines[r].unshift('track type="featureTable" name="'+i+'" collapseByGene="'+(r=="genes"?"on":"off")+'"\n'),t.availTracks.push({fh:{},n:r,s:["dense","squish","pack"],h:15,m:["pack"],customData:e.data.trackLines[r]}),t.tracks.push({n:r}),t.trackDesc[r]={cat:"Feature Tracks",sm:i,lg:s}})},parse:function(e){var t=this,n=t.opts,r="\n//\n",i=e.split(r),u=null;t.data.sequence=[],_.each(i,function(e){if(!s(e).length)return;var r={orig:{}},i,a,c;_.each(o(e),function(e){var n=f(e,t.tagSize);_.isUndefined(r.orig[n])?r.orig[n]=e:r.orig[n]+=e}),t.data.contigs.push(r),t.format().parseLocus(r),t.format().parseHeaderFields(r),c=t.format().parseSequence(r),i=r.accession&&r.accession!="unknown"?r.accession:r.entryId,i=l(i,n.chrLengths);if(r.length){a=r.length;if(a!=c.length)throw new Error("Sequence data for contig "+i+" does not match length "+a+"bp from header")}else a=c.length;n.chrOrder.push(i),n.chrLengths[i]=a,n.genomeSize+=a,t.format().parseFeatureTable(i,r),t.data.sequence.push(c),u=u||r}),t.data.sequence=t.data.sequence.join(""),t.canGetSequence=!0,t.format().createTracksFromFeatures(),n.species=u.source?u.source[0].organism.split("\n")[0]:"Custom Genome",u.date&&(n.assemblyDate=u.date)}};t.exports=c},{"./utils/utils.js":9}],9:[function(e,t,n){var r=e("../../track-types/utils/utils.js");t.exports.parseInt10=r.parseInt10,t.exports.deepClone=function(e){return JSON.parse(JSON.stringify(e))},t.exports.log10=function(e){return Math.log(e)/Math.LN10};var i=t.exports.strip=r.strip;t.exports.roundToPlaces=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},t.exports.topTagsAsArray=function(e){return e.replace(/\n([A-Za-z\/\*])/g,"\n$1").split("")},t.exports.subTagsAsArray=function(e,t){if(!isFinite(t)||t<2)throw"invalid tagSize";var n=new RegExp("\\n(\\s{1,"+(t-1)+"}\\S)","g");return e.replace(n,"\n$1").split("")},t.exports.fetchField=function(e,t){if(!isFinite(t)||t<1)throw"invalid tagSize";var n=new RegExp("(^|\\n).{0,"+t+"}","g");return i(e.replace(n,"$1"))},t.exports.getTag=function(e,t){if(!isFinite(t)||t<1)throw"invalid tagSize";return i(e.substring(0,t).toLowerCase())},t.exports.ensureUnique=function(e,t){var n=1,r=e;while(typeof t[r]!="undefined")r=e+"_"+n++;return r},t.exports.optsAsTrackLine=function(e){return _.map(e,function(e,t){return t+'="'+e.toString().replace(/"/g,"")+'"'}).join(" ")}},{"../../track-types/utils/utils.js":22}],10:[function(e,t,n){t.exports=function(e){e.window=e.window||e,e.window.document=e.window.document||{},function(e,t){function n(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function r(){try{return new e.XMLHttpRequest}catch(t){}}function i(e,n){e.dataFilter&&(n=e.dataFilter(n,e.dataType));var r=e.dataTypes,i={},s,o,u=r.length,a,f=r[0],l,c,h,d,v;for(s=1;s<u;s++){if(s===1)for(o in e.converters)typeof o=="string"&&(i[o.toLowerCase()]=e.converters[o]);l=f,f=r[s];if(f==="*")f=l;else if(l!=="*"&&l!==f){c=l+" "+f,h=i[c]||i["* "+f];if(!h){v=t;for(d in i){a=d.split(" ");if(a[0]===l||a[0]==="*"){v=i[a[1]+" "+f];if(v){d=i[d],d===!0?h=v:v===!0&&(h=d);break}}}}!h&&!v&&p.error("No conversion from "+c.replace(" "," to ")),h!==!0&&(n=h?h(n):v(d(n)))}}return n}function s(e,n,r){var i=e.contents,s=e.dataTypes,o=e.responseFields,u,a,f,l;for(a in o)a in r&&(n[o[a]]=r[a]);while(s[0]==="*")s.shift(),u===t&&(u=e.mimeType||n.getResponseHeader("content-type"));if(u)for(a in i)if(i[a]&&i[a].test(u)){s.unshift(a);break}if(s[0]in r)f=s[0];else{for(a in r){if(!s[0]||e.converters[a+" "+s[0]]){f=a;break}l||(l=a)}f=f||l}if(f)return f!==s[0]&&s.unshift(f),r[f]}function o(e,t,n,r){if(p.isArray(t))p.each(t,function(t,i){n||g.test(e)?r(e,i):o(e+"["+(typeof i=="object"||p.isArray(i)?t:"")+"]",i,n,r)});else if(!n&&t!=null&&typeof t=="object")for(var i in t)o(e+"["+i+"]",t[i],n,r);else r(e,t)}function u(e,n){var r,i,s=p.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);i&&p.extend(!0,e,i)}function a(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u=e[s],f=0,l=u?u.length:0,c=e===_,h;for(;f<l&&(c||!h);f++)h=u[f](n,r,i),typeof h=="string"&&(!c||o[h]?h=t:(n.dataTypes.unshift(h),h=a(e,n,r,i,h,o)));return(c||!h)&&!o["*"]&&(h=a(e,n,r,i,"*",o)),h}function f(e){return function(t,n){typeof t!="string"&&(n=t,t="*");if(p.isFunction(n)){var r=t.toLowerCase().split(L),i=0,s=r.length,o,u,a;for(;i<s;i++)o=r[i],a=/^\+/.test(o),a&&(o=o.substr(1)||"*"),u=e[o]=e[o]||[],u[a?"unshift":"push"](n)}}}var l=e.document,c=e.navigator,h=e.location,p=function(){function n(){if(r.isReady)return;try{l.documentElement.doScroll("left")}catch(e){setTimeout(n,1);return}r.ready()}var r=function(e,t){return new r.fn.init(e,t,o)},i=e.jQuery,s=e.$,o,u=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,a=/\S/,f=/^\s+/,h=/\s+$/,p=/\d/,d=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,v=/^[\],:{}\s]*$/,m=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,g=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,y=/(?:^|:|,)(?:\s*\[)+/g,b=/(webkit)[ \/]([\w.]+)/,w=/(opera)(?:.*version)?[ \/]([\w.]+)/,E=/(msie) ([\w.]+)/,S=/(mozilla)(?:.*? rv:([\w.]+))?/,x=/-([a-z])/ig,T=function(e,t){return t.toUpperCase()},N=c.userAgent,C,k,L,A=Object.prototype.toString,O=Object.prototype.hasOwnProperty,M=Array.prototype.push,_=Array.prototype.slice,D=String.prototype.trim,P=Array.prototype.indexOf,H={};return r.fn=r.prototype={constructor:r,init:function(e,n,i){var s,o,a,f;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(e==="body"&&!n&&l.body)return this.context=l,this[0]=l.body,this.selector=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?s=[null,e,null]:s=u.exec(e);if(s&&(s[1]||!n)){if(s[1])return n=n instanceof r?n[0]:n,f=n?n.ownerDocument||n:l,a=d.exec(e),a?r.isPlainObject(n)?(e=[l.createElement(a[1])],r.fn.attr.call(e,n,!0)):e=[f.createElement(a[1])]:(a=r.buildFragment([s[1]],[f]),e=(a.cacheable?r.clone(a.fragment):a.fragment).childNodes),r.merge(this,e);o=l.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return i.find(e);this.length=1,this[0]=o}return this.context=l,this.selector=e,this}return!n||n.jquery?(n||i).find(e):this.constructor(n).find(e)}return r.isFunction(e)?i.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),r.makeArray(e,this))},selector:"",jquery:"1.6.3pre",length:0,size:function(){return this.length},toArray:function(){return _.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var i=this.constructor();return r.isArray(e)?M.apply(i,e):r.merge(i,e),i.prevObject=this,i.context=this.context,t==="find"?i.selector=this.selector+(this.selector?" ":"")+n:t&&(i.selector=this.selector+"."+t+"("+n+")"),i},each:function(e,t){return r.each(this,e,t)},ready:function(e){return r.bindReady(),k.done(e),this},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(_.apply(this,arguments),"slice",_.call(arguments).join(","))},map:function(e){return this.pushStack(r.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:M,sort:[].sort,splice:[].splice},r.fn.init.prototype=r.fn,r.extend=r.fn.extend=function(){var e,n,i,s,o,u,a=arguments[0]||{},f=1,l=arguments.length,c=!1;typeof a=="boolean"&&(c=a,a=arguments[1]||{},f=2),typeof a!="object"&&!r.isFunction(a)&&(a={}),l===f&&(a=this,--f);for(;f<l;f++)if((e=arguments[f])!=null)for(n in e){i=a[n],s=e[n];if(a===s)continue;c&&s&&(r.isPlainObject(s)||(o=r.isArray(s)))?(o?(o=!1,u=i&&r.isArray(i)?i:[]):u=i&&r.isPlainObject(i)?i:{},a[n]=r.extend(c,u,s)):s!==t&&(a[n]=s)}return a},r.extend({noConflict:function(t){return e.$===r&&(e.$=s),t&&e.jQuery===r&&(e.jQuery=i),r},isReady:!1,readyWait:1,holdReady:function(e){e?r.readyWait++:r.ready(!0)},ready:function(e){if(e===!0&&!--r.readyWait||e!==!0&&!r.isReady){if(!l.body)return setTimeout(r.ready,1);r.isReady=!0;if(e!==!0&&--r.readyWait>0)return;k.resolveWith(l,[r]),r.fn.trigger&&r(l).trigger("ready").unbind("ready")}},bindReady:function(){if(k)return;k=r._Deferred();if(l.readyState==="complete")return setTimeout(r.ready,1);if(l.addEventListener)l.addEventListener("DOMContentLoaded",L,!1),e.addEventListener("load",r.ready,!1);else if(l.attachEvent){l.attachEvent("onreadystatechange",L),e.attachEvent("onload",r.ready);var t=!1;try{t=e.frameElement==null}catch(i){}l.documentElement.doScroll&&t&&n()}},isFunction:function(e){return r.type(e)==="function"},isArray:Array.isArray||function(e){return r.type(e)==="array"},isWindow:function(e){return e&&typeof e=="object"&&"setInterval"in e},isNaN:function(e){return e==null||!p.test(e)||isNaN(e)},type:function(e){return e==null?String(e):H[A.call(e)]||"object"},isPlainObject:function(e){if(!e||r.type(e)!=="object"||e.nodeType||r.isWindow(e))return!1;if(e.constructor&&!O.call(e,"constructor")&&!O.call(e.constructor.prototype,"isPrototypeOf"))return!1;var n;for(n in e);return n===t||O.call(e,n)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw e},parseJSON:function(t){if(typeof t!="string"||!t)return null;t=r.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(v.test(t.replace(m,"@").replace(g,"]").replace(y,"")))return(new Function("return "+t))();r.error("Invalid JSON: "+t)},parseXML:function(n){var i,s;try{e.DOMParser?(s=new DOMParser,i=s.parseFromString(n,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(n))}catch(o){i=t}return(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)&&r.error("Invalid XML: "+n),i},noop:function(){},globalEval:function(t){t&&a.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(x,T)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,i){var s,o=0,u=e.length,a=u===t||r.isFunction(e);if(i){if(a){for(s in e)if(n.apply(e[s],i)===!1)break}else for(;o<u;)if(n.apply(e[o++],i)===!1)break}else if(a){for(s in e)if(n.call(e[s],s,e[s])===!1)break}else for(;o<u;)if(n.call(e[o],o,e[o++])===!1)break;return e},trim:D?function(e){return e==null?"":D.call(e)}:function(e){return e==null?"":e.toString().replace(f,"").replace(h,"")},makeArray:function(e,t){var n=t||[];if(e!=null){var i=r.type(e);e.length==null||i==="string"||i==="function"||i==="regexp"||r.isWindow(e)?M.call(n,e):r.merge(n,e)}return n},inArray:function(e,t){if(P)return P.call(t,e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1},merge:function(e,n){var r=e.length,i=0;if(typeof n.length=="number")for(var s=n.length;i<s;i++)e[r++]=n[i];else while(n[i]!==t)e[r++]=n[i++];return e.length=r,e},grep:function(e,t,n){var r=[],i;n=!!n;for(var s=0,o=e.length;s<o;s++)i=!!t(e[s],s),n!==i&&r.push(e[s]);return r},map:function(e,n,i){var s,o,u=[],a=0,f=e.length,l=e instanceof r||f!==t&&typeof f=="number"&&(f>0&&e[0]&&e[f-1]||f===0||r.isArray(e));if(l)for(;a<f;a++)s=n(e[a],a,i),s!=null&&(u[u.length]=s);else for(o in e)s=n(e[o],o,i),s!=null&&(u[u.length]=s);return u.concat.apply([],u)},guid:1,proxy:function(e,n){if(typeof n=="string"){var i=e[n];n=e,e=i}if(!r.isFunction(e))return t;var s=_.call(arguments,2),o=function(){return e.apply(n,s.concat(_.call(arguments)))};return o.guid=e.guid=e.guid||o.guid||r.guid++,o},access:function(e,n,i,s,o,u){var a=e.length;if(typeof n=="object"){for(var f in n)r.access(e,f,n[f],s,o,i);return e}if(i!==t){s=!u&&s&&r.isFunction(i);for(var l=0;l<a;l++)o(e[l],n,s?i.call(e[l],l,o(e[l],n)):i,u);return e}return a?o(e[0],n):t},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=b.exec(e)||w.exec(e)||E.exec(e)||e.indexOf("compatible")<0&&S.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,n){return new e.fn.init(t,n)}r.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function n(i,n){return n&&n instanceof r&&!(n instanceof e)&&(n=e(n)),r.fn.init.call(this,i,n,t)},e.fn.init.prototype=e.fn;var t=e(l);return e},browser:{}}),r.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){H["[object "+t+"]"]=t.toLowerCase()}),C=r.uaMatch(N),C.browser&&(r.browser[C.browser]=!0,r.browser.version=C.version),r.browser.webkit&&(r.browser.safari=!0),a.test(" ")&&(f=/^[\s\xA0]+/,h=/[\s\xA0]+$/),o=r(l),l.addEventListener?L=function(){l.removeEventListener("DOMContentLoaded",L,!1),r.ready()}:l.attachEvent&&(L=function(){l.readyState==="complete"&&(l.detachEvent("onreadystatechange",L),r.ready())}),r}(),d="done fail isResolved isRejected promise then always pipe".split(" "),v=[].slice;p.extend({_Deferred:function(){var e=[],t,n,r,i={done:function(){if(!r){var n=arguments,s,o,u,a,f;t&&(f=t,t=0);for(s=0,o=n.length;s<o;s++)u=n[s],a=p.type(u),a==="array"?i.done.apply(i,u):a==="function"&&e.push(u);f&&i.resolveWith(f[0],f[1])}return this},resolveWith:function(i,s){if(!r&&!t&&!n){s=s||[],n=1;try{while(e[0])e.shift().apply(i,s)}finally{t=[i,s],n=0}}return this},resolve:function(){return i.resolveWith(this,arguments),this},isResolved:function(){return!!n||!!t},cancel:function(){return r=1,e=[],this}};return i},Deferred:function(e){var t=p._Deferred(),n=p._Deferred(),r;return p.extend(t,{then:function(e,n){return t.done(e).fail(n),this},always:function(){return t.done.apply(t,arguments).fail.apply(this,arguments)},fail:n.done,rejectWith:n.resolveWith,reject:n.resolve,isRejected:n.isResolved,pipe:function(e,n){return p.Deferred(function(r){p.each({done:[e,"resolve"],fail:[n,"reject"]},function(e,n){var i=n[0],s=n[1],o;p.isFunction(i)?t[e](function(){o=i.apply(this,arguments),o&&p.isFunction(o.promise)?o.promise().then(r.resolve,r.reject):r[s+"With"](this===t?r:this,[o])}):t[e](r[s])})}).promise()},promise:function(e){if(e==null){if(r)return r;r=e={}}var n=d.length;while(n--)e[d[n]]=t[d[n]];return e}}),t.done(n.cancel).fail(t.cancel),delete t.cancel,e&&e.call(t,t),t},when:function(e){function t(e){return function(t){n[e]=arguments.length>1?v.call(arguments,0):t,--s||o.resolveWith(o,v.call(n,0))}}var n=arguments,r=0,i=n.length,s=i,o=i<=1&&e&&p.isFunction(e.promise)?e:p.Deferred();if(i>1){for(;r<i;r++)n[r]&&p.isFunction(n[r].promise)?n[r].promise().then(t(r),o.reject):--s;s||o.resolveWith(o,n)}else o!==e&&o.resolveWith(o,i?[e]:[]);return o.promise()}}),p.support=p.support||{};var m=/%20/g,g=/\[\]$/,y=/\r?\n/g,b=/#.*$/,w=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,E=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,S=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,x=/^(?:GET|HEAD)$/,T=/^\/\//,N=/\?/,C=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,k=/^(?:select|textarea)/i,L=/\s+/,A=/([?&])_=[^&]*/,O=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,M=p.fn.load,_={},D={},P,H;try{P=h.href}catch(B){P=l.createElement("a"),P.href="",P=P.href}H=O.exec(P.toLowerCase())||[],p.fn.extend({load:function(e,n,r){if(typeof e!="string"&&M)return M.apply(this,arguments);if(!this.length)return this;var i=e.indexOf(" ");if(i>=0){var s=e.slice(i,e.length);e=e.slice(0,i)}var o="GET";n&&(p.isFunction(n)?(r=n,n=t):typeof n=="object"&&(n=p.param(n,p.ajaxSettings.traditional),o="POST"));var u=this;return p.ajax({url:e,type:o,dataType:"html",data:n,complete:function(e,t,n){n=e.responseText,e.isResolved()&&(e.done(function(e){n=e}),u.html(s?p("<div>").append(n.replace(C,"")).find(s):n)),r&&u.each(r,[n,t,e])}}),this},serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?p.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||k.test(this.nodeName)||E.test(this.type))}).map(function(e,t){var n=p(this).val();return n==null?null:p.isArray(n)?p.map(n,function(e,n){return{name:t.name,value:e.replace(y,"\r\n")}}):{name:t.name,value:n.replace(y,"\r\n")}}).get()}}),p.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){p.fn[t]=function(e){return this.bind(t,e)}}),p.each(["get","post"],function(e,n){p[n]=function(e,r,i,s){return p.isFunction(r)&&(s=s||i,i=r,r=t),p.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),p.extend({getScript:function(e,n){return p.get(e,t,n,"script")},getJSON:function(e,t,n){return p.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?u(e,p.ajaxSettings):(t=e,e=p.ajaxSettings),u(e,t),e},ajaxSettings:{url:P,isLocal:S.test(H[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:f(_),ajaxTransport:f(D),ajax:function(e,n){function r(e,n,r,a){if(k===2)return;k=2,S&&clearTimeout(S),E=t,g=a||"",B.readyState=e>0?4:0;var v,m,y,b=n,w=r?s(o,B,r):t,x,T;if(e>=200&&e<300||e===304){if(o.ifModified){if(x=B.getResponseHeader("Last-Modified"))p.lastModified[d]=x;if(T=B.getResponseHeader("Etag"))p.etag[d]=T}if(e===304)b="notmodified",v=!0;else try{m=i(o,w),b="success",v=!0}catch(N){b="parsererror",y=N}}else{y=b;if(!b||e)b="error",e<0&&(e=0)}B.status=e,B.statusText=""+(n||b),v?l.resolveWith
(u,[m,b,B]):l.rejectWith(u,[B,b,y]),B.statusCode(h),h=t,M&&f.trigger("ajax"+(v?"Success":"Error"),[B,o,v?m:y]),c.resolveWith(u,[B,b]),M&&(f.trigger("ajaxComplete",[B,o]),--p.active||p.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var o=p.ajaxSetup({},n),u=o.context||o,f=u!==o&&(u.nodeType||u instanceof p)?p(u):p.event,l=p.Deferred(),c=p._Deferred(),h=o.statusCode||{},d,v={},m={},g,y,E,S,C,k=0,M,P,B={readyState:0,setRequestHeader:function(e,t){if(!k){var n=e.toLowerCase();e=m[n]=m[n]||e,v[e]=t}return this},getAllResponseHeaders:function(){return k===2?g:null},getResponseHeader:function(e){var n;if(k===2){if(!y){y={};while(n=w.exec(g))y[n[1].toLowerCase()]=n[2]}n=y[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return k||(o.mimeType=e),this},abort:function(e){return e=e||"abort",E&&E.abort(e),r(0,e),this}};l.promise(B),B.success=B.done,B.error=B.fail,B.complete=c.done,B.statusCode=function(e){if(e){var t;if(k<2)for(t in e)h[t]=[h[t],e[t]];else t=e[B.status],B.then(t,t)}return this},o.url=((e||o.url)+"").replace(b,"").replace(T,H[1]+"//"),o.dataTypes=p.trim(o.dataType||"*").toLowerCase().split(L),o.crossDomain==null&&(C=O.exec(o.url.toLowerCase()),o.crossDomain=!(!C||C[1]==H[1]&&C[2]==H[2]&&(C[3]||(C[1]==="http:"?80:443))==(H[3]||(H[1]==="http:"?80:443)))),o.data&&o.processData&&typeof o.data!="string"&&(o.data=p.param(o.data,o.traditional)),a(_,o,n,B);if(k===2)return!1;M=o.global,o.type=o.type.toUpperCase(),o.hasContent=!x.test(o.type),M&&p.active++===0&&p.event.trigger("ajaxStart");if(!o.hasContent){o.data&&(o.url+=(N.test(o.url)?"&":"?")+o.data,delete o.data),d=o.url;if(o.cache===!1){var j=p.now(),F=o.url.replace(A,"$1_="+j);o.url=F+(F===o.url?(N.test(o.url)?"&":"?")+"_="+j:"")}}(o.data&&o.hasContent&&o.contentType!==!1||n.contentType)&&B.setRequestHeader("Content-Type",o.contentType),o.ifModified&&(d=d||o.url,p.lastModified[d]&&B.setRequestHeader("If-Modified-Since",p.lastModified[d]),p.etag[d]&&B.setRequestHeader("If-None-Match",p.etag[d])),B.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+(o.dataTypes[0]!=="*"?", */*; q=0.01":""):o.accepts["*"]);for(P in o.headers)B.setRequestHeader(P,o.headers[P]);if(!o.beforeSend||o.beforeSend.call(u,B,o)!==!1&&k!==2){for(P in{success:1,error:1,complete:1})B[P](o[P]);E=a(D,o,n,B);if(!E)r(-1,"No Transport");else{B.readyState=1,M&&f.trigger("ajaxSend",[B,o]),o.async&&o.timeout>0&&(S=setTimeout(function(){B.abort("timeout")},o.timeout));try{k=1,E.send(v,r)}catch(I){k<2?r(-1,I):p.error(I)}}return B}return B.abort(),!1},param:function(e,n){var r=[],i=function(e,t){t=p.isFunction(t)?t():t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=p.ajaxSettings.traditional);if(p.isArray(e)||e.jquery&&!p.isPlainObject(e))p.each(e,function(){i(this.name,this.value)});else for(var s in e)o(s,e[s],n,i);return r.join("&").replace(m,"+")}}),p.extend({active:0,lastModified:{},etag:{}});var j=e.ActiveXObject?function(){for(var e in I)I[e](0,1)}:!1,F=0,I;p.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&r()||n()}:r,function(e){p.extend(p.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(p.ajaxSettings.xhr()),p.support.ajax&&p.ajaxTransport(function(n){if(!n.crossDomain||p.support.cors){var r;return{send:function(i,s){var o=n.xhr(),u,a;n.username?o.open(n.type,n.url,n.async,n.username,n.password):o.open(n.type,n.url,n.async);if(n.xhrFields)for(a in n.xhrFields)o[a]=n.xhrFields[a];n.mimeType&&o.overrideMimeType&&o.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(a in i)o.setRequestHeader(a,i[a])}catch(f){}o.send(n.hasContent&&n.data||null),r=function(e,i){var a,f,l,c,h;try{if(r&&(i||o.readyState===4)){r=t,u&&(o.onreadystatechange=p.noop,j&&delete I[u]);if(i)o.readyState!==4&&o.abort();else{a=o.status,l=o.getAllResponseHeaders(),c={},h=o.responseXML,h&&h.documentElement&&(c.xml=h),c.text=o.responseText;try{f=o.statusText}catch(d){f=""}!a&&n.isLocal&&!n.crossDomain?a=c.text?200:404:a===1223&&(a=204)}}}catch(v){i||s(-1,v)}c&&s(a,f,c,l)},!n.async||o.readyState===4?r():(u=++F,j&&(I||(I={},p(e).unload(j)),I[u]=r),o.onreadystatechange=r)},abort:function(){r&&r(0,1)}}}}),p.ajaxSettings.global=!1,e.jQuery=e.$=p}(e)}},{}],11:[function(e,t,n){var r=e("./utils/utils.js"),i=r.floorHack,s=r.parseInt10,o=e("./utils/PairedIntervalTree.js").PairedIntervalTree,u=e("./utils/RemoteTrack.js").RemoteTrack,a={defaults:{chromosomes:"",itemRgb:"off",color:"188,188,188",colorByStrand:"",useScore:0,group:"user",priority:"user",offset:0,detail:!1,url:"",htmlUrl:"",drawLimit:{squish:2e3,pack:2e3},alleleFreqThreshold:.2,optimalFetchWindow:0,maxFetchWindow:0,convertChrScheme:null,viewAsPairs:!1},flags:{isReadPaired:1,isReadProperlyAligned:2,isReadUnmapped:4,isMateUnmapped:8,readStrandReverse:16,mateStrandReverse:32,isReadFirstOfPair:64,isReadLastOfPair:128,isSecondaryAlignment:256,isReadFailingVendorQC:512,isDuplicateRead:1024,isSupplementaryAlignment:2048},init:function(){var e=_.keys(this.browserOpts);if(!this.opts.bigDataUrl)throw new Error("Required parameter bigDataUrl not found for BAM track at "+JSON.stringify(this.opts)+(this.opts.lineNum+1));this.browserChrScheme=this.type("bam").guessChrScheme(_.keys(this.browserOpts.chrPos))},guessChrScheme:function(e){return limit=Math.min(e.length*.8,20),_.filter(e,function(e){return/^chr/.test(e)}).length>limit?"ucsc":_.filter(e,function(e){return/^\d\d?$/.test(e)}).length>limit?"ensembl":null},parse:function(e){var t=this,n=t.opts,r=t.browserOpts.genomeSize/2,s=new o(i(r),{startKey:"start",endKey:"end"},{startKey:"templateStart",endKey:"templateEnd",pairedLengthKey:"tlen",pairingKey:"qname"}),a=t.ajaxDir()+"bam.php",f;return f=new u(s,function(e,r,i){range=t.chrRange(e,r);switch(n.convertChrScheme){case"ensembl_ucsc":range=_.map(range,function(e){return e.replace(/^chr/,"")});break;case"ucsc_ensembl":range=_.map(range,function(e){return e.replace(/^(\d\d?|X):/,"chr$1:")})}$.ajax(a,{data:{range:range,url:t.opts.bigDataUrl},success:function(e){var n=_.filter(e.split("\n"),function(e){var t=e.match(/\t/g);return t&&t.length>=2}),r=_.map(n,function(e){return t.type("bam").parseLine.call(t,e)});i(r)}})}),t.data={cache:s,remote:f,pileup:{},info:{}},t.heights={max:null,min:24,start:24},t.sizes=["dense","squish","pack"],t.mapSizes=["pack"],t.noAreaLabels=!0,t.expectsSequence=!0,t.renderSequenceCallbacks={},$.ajax(a,{data:{url:n.bigDataUrl},success:function(e){var r=0,i=_.max(_.values(n.drawLimit)),s=[],o,u;_.each(e.split("\n"),function(e){var t=e.split("	"),n=parseInt(t[2],10);if(t.length==1&&t[0]=="")return;s.push(t[0]);if(_.isNaN(n))throw new Error("Invalid output for samtools idxstats on this BAM track.");r+=n}),t.data.info.chrScheme=o=t.type("bam").guessChrScheme(s),n.convertChrScheme!==!1&&o&&t.browserChrScheme&&(n.convertChrScheme=o!=t.browserChrScheme?o+"_"+t.browserChrScheme:null),t.data.info.meanItemsPerBp=u=r/t.browserOpts.genomeSize,t.data.info.meanItemLength=100,n.maxFetchWindow=i/u,n.optimalFetchWindow=Math.floor(n.maxFetchWindow/2),t.data.cache.setPairingInterval(10,5e3),f.setupBins(t.browserOpts.genomeSize,n.optimalFetchWindow,n.maxFetchWindow)}}),!0},parseFlags:function(e,t){e.flags={},_.each(this.type("bam").flags,function(t,n){e.flags[n]=!!(e.flag&t)})},parseCigar:function(e,t){var n=e.cigar,r=0,i=0,o,u;e.blocks=[],e.insertions=[],ops=n.split(/\d+/).slice(1),u=n.split(/[A-Z=]/).slice(0,-1);if(ops.length!=u.length){this.warn("Invalid CIGAR '"+n+"' for "+e.desc);return}u=_.map(u,s),_.each(ops,function(t,n){var s=u[n],o,a;/^[MX=]$/.test(t)?(o={start:e.start+r},o.end=o.start+s,o.type=t,o.seq=e.seq.slice(i,i+s),e.blocks.push(o),r+=s,i+=s):/^[ND]$/.test(t)?r+=s:t=="I"?(a={start:e.start+r,end:e.start+r},a.seq=e.seq.slice(i,i+s),e.insertions.push(a),i+=s):t=="S"&&(i+=s)}),e.end=e.start+r},parseLine:function(e,t){var n=this.opts,r=["qname","flag","rname","pos","mapq","cigar","rnext","pnext","tlen","seq","qual"],i={},o=e.split("	"),u,a;_.each(_.first(o,r.length),function(e,t){i[r[t]]=e});switch(n.convertChrScheme){case"ucsc_ensembl":i.rname=i.rname.replace(/^chr/,"");break;case"ensembl_ucsc":i.rname=(/^(\d\d?|X)$/.test(i.rname)?"chr":"")+i.rname}return i.name=i.qname,i.flag=s(i.flag),u=this.browserOpts.chrPos[i.rname],t=t||0,_.isUndefined(u)?(this.warn("Invalid RNAME '"+i.rname+"' at line "+(t+1+this.opts.lineNum)),null):i.pos==="0"||!i.cigar||i.cigar=="*"?null:(i.score=_.isUndefined(i.score)?"?":i.score,i.start=u+s(i.pos),i.desc=i.qname+" at "+i.rname+":"+i.pos,i.tlen=s(i.tlen),this.type("bam").parseFlags.call(this,i,t),i.strand=i.flags.readStrandReverse?"-":"+",this.type("bam").parseCigar.call(this,i,t),i.id=[i.qname,i.flag,i.rname,i.pos,i.cigar].join("	"),i)},pileup:function(e,t,n){var r=this.data.pileup,i={},s=0,o;for(o=t;o<n;o++)r[o]||(i[o]=!0,s++);if(s===0)return;_.each(e,function(e){_.each(e.data.blocks,function(e){var s,o;for(o=Math.max(e.start,t);o<Math.min(e.end,n);o++){if(!i[o])continue;s=(e.seq[o-e.start]||"").toUpperCase(),r[o]=r[o]||{A:0,C:0,G:0,T:0,N:0,cov:0},/[ACTGN]/.test(s)&&(r[o][s]+=1),r[o].cov+=1}})})},coverage:function(e,t,n){var i=e,s=this.data.info.meanItemsPerBp*this.data.info.meanItemLength*2,o=this.data.pileup[i],u=[],a,f,l;for(l=0;l<t;l++){f=o&&i+1>=l*n+e?[o.cov]:[],a=this.data.pileup[i+1];while(i+1<(l+1)*n+e&&i+2>=l*n+e)a&&f.push(a.cov),++i,o=a,a=this.data.pileup[i+1];u.push(r.wigBinFunctions.maximum(f)/s)}return u},alleles:function(e,t,n){var r=this.data.pileup,i=this.data.info.meanItemsPerBp*this.data.info.meanItemLength*2,s=this.opts.alleleFreqThreshold,o=[],u,a,f,l;for(f=0;f<t.length;f++)a=t[f].toUpperCase(),l=r[e+f],l&&l.cov&&l[a]/l.cov<1-s&&(u={x:f/n,splits:[]},_.each(["A","C","G","T"],function(e){l[e]>0&&u.splits.push({nt:e,h:l[e]/i})}),o.push(u));return o},mismatches:function(e,t,n,r,i,s){var o=[];return t=t.toUpperCase(),_.each(r,function(r){_.each(r.data.blocks,function(u){var a=s(r.data),f,l,c;for(l=Math.max(u.start,e);l<Math.min(u.end,e+i*n);l++)c=(l-e)/n,f=(u.seq[l-u.start]||"").toUpperCase(),f&&f!=t[l-e]&&a&&o.push({x:c,nt:f,line:a})})}),o},prerender:function(e,t,n,i,s){function h(e,t){var r=c+"_"+n;return _.isUndefined(t)?e.line&&e.line[r]:(e.line||(e.line={}),e.line[r]=t)}var o=this,u=i.width,a=i.sequence,f=o.data,l=o.opts.viewAsPairs,c=(t-e)/u;o.opts.maxFetchWindow&&t-e>o.opts.maxFetchWindow?s({tooMany:!0}):o.data.remote.fetchAsync(e,t,l,function(n){var i={sequence:!!a,width:u},f=new r.pixIntervalCalculator(e,u,c,!1);if(n.tooMany)return s(n);a?(i.bppp=c,i.alleles=o.type("bam").alleles.call(o,e,a,c),i.mismatches=o.type("bam").mismatches.call(o,e,a,c,n,u,h)):(o.type("bam").pileup.call(o,n,e,t),i.layout=o.type("bed").stackedLayout.call(o,n,u,f,h),_.each(i.layout,function(e){_.each(e,function(e){e.insertionPts=_.map(e.d.insertions,f)})}),i.coverage=o.type("bam").coverage.call(o,e,u,c)),s(i)})},tipTipData:function(e){var t={position:e.d.rname+":"+e.d.pos,"read strand":e.d.flags.readStrand?"(-)":"(+)","map quality":e.d.mapq};return t},drawCoverage:function(e,t,n){_.each(t,function(t,r){if(t===null)return;e.fillRect(r,Math.max(n-t*n,0),1,Math.min(t*n,n))})},drawStrandIndicator:function(e,t,n,r,i,s){var o=e.fillStyle;s?(e.beginPath(),e.moveTo(t-2*i,n),e.lineTo(t+3*i,n+r/2),e.lineTo(t-2*i,n+r),e.closePath(),e.fill()):(e.fillStyle="rgb(140,140,140)",e.fillRect(t+(i>0?-2:1),n,1,r),e.fillRect(t+(i>0?-1:0),n+1,1,r-2),e.fillStyle=o)},drawAlignment:function(e,t,n,r,i){var s=this,o=s.opts.color,u=i>6?2:0,a=2,f=i>6?2:1,l=Math.round(.5*i)-a*.5;e.fillStyle=e.strokeStyle="rgb(0,0,0)",e.fillRect(n.pInt.x,r*i+l,n.pInt.w-1,a),s.opts.altColor&&n.d.strand=="-"&&(o=s.opts.altColor),e.fillStyle=e.strokeStyle="rgb("+o+")",_.each(n.blockInts,function(o,a){var f=r*i+u/2,l=i-u;if(o.x+o.w<0||o.x>t)return;a==0&&n.d.strand=="-"&&!o.oPrev?(e.fillRect(o.x+2,f,o.w-2,l),s.type("bam").drawStrandIndicator.call(s,e,o.x,f,l,-1,i>6)):a==n.blockInts.length-1&&n.d.strand=="+"&&!o.oNext?(e.fillRect(o.x,f,o.w-2,l),s.type("bam").drawStrandIndicator.call(s,e,o.x+o.w,f,l,1,i>6)):e.fillRect(o.x,f,o.w,l)}),e.fillStyle=e.strokeStyle="rgb(114,41,218)",_.each(n.insertionPts,function(n){if(n.x+n.w<0||n.x>t)return;e.fillRect(n.x-1,r*i,2,i),e.fillRect(n.x-2,r*i,4,f),e.fillRect(n.x-2,(r+1)*i-f,4,f)})},drawAlleles:function(e,t,n,r){var i={A:"255,0,0",T:"255,0,255",C:"0,0,255",G:"0,180,0"},s;_.each(t,function(t){s=n,_.each(t.splits,function(o){e.fillStyle="rgb("+i[o.nt]+")",e.fillRect(t.x,s-=o.h*n,Math.max(r,1),o.h*n)})})},drawMismatch:function(e,t,n,r,i){var s={A:"255,0,0",T:"255,0,255",C:"0,0,255",G:"0,180,0"},o=r>6?2:0,u;e.fillStyle="rgb("+s[t.nt]+")",e.fillRect(t.x,(t.line+n)*r+o/2,Math.max(i,1),r-o),i>7&&r>10&&(e.fillStyle="rgb(255,255,255)",e.fillText(t.nt,t.x+i*.5,(t.line+n+1)*r-o))},drawSpec:function(e,t,n){var r=this,i=e.getContext&&e.getContext("2d"),s='javascript:void("'+r.opts.name+':$$")',o=r.opts.drawLimit&&r.opts.drawLimit[n],u=n=="pack"?14:4,a=n=="dense"?24:38,f=7,l=(a+f)/u,c=r.opts.color,h=null;if(!i)throw"Canvas not supported";if(!t.sequence){if(t.tooMany||o&&t.layout.length>o){e.height=0,e.className=e.className+" too-many";return}n=="pack"&&!r.areas[e.id]&&(h=r.areas[e.id]=[]),e.height=a+(n=="dense"?0:f+t.layout.length*u),i.fillStyle="rgb(159,159,159)",r.type("bam").drawCoverage.call(r,i,t.coverage,a),n!="dense"&&(i.fillStyle="rgb(109,109,109)",i.fillRect(0,a+1,t.width,1),i.fillStyle=i.strokeStyle="rgb("+c+")",_.each(t.layout,function(e,n){n+=l,_.each(e,function(e){r.type("bam").drawAlignment.call(r,i,t.width,e,n,u),r.type("bed").addArea.call(r,h,e,n,u,s)})}))}else r.type("bam").drawAlleles.call(r,i,t.alleles,a,1/t.bppp),i.font="12px 'Menlo','Bitstream Vera Sans Mono','Consolas','Lucida Console',monospace",i.textAlign="center",i.textBaseline="baseline",_.each(t.mismatches,function(e){r.type("bam").drawMismatch.call(r,i,e,l,u,1/t.bppp)})},render:function(e,t,n,r,i){var s=this;s.prerender(t,n,r,{width:e.width},function(o){var u=t+"-"+n+"-"+r;s.type("bam").drawSpec.call(s,e,o,r),_.isFunction(s.renderSequenceCallbacks[u])&&(s.renderSequenceCallbacks[u](),delete s.renderSequenceCallbacks[u]),_.isFunction(i)&&i()})},renderSequence:function(e,t,n,r,i,s){function u(){o.prerender(t,n,r,{width:e.width,sequence:i},function(t){o.type("bam").drawSpec.call(o,e,t,r),_.isFunction(s)&&s()})}var o=this;if(!i)return!1;(" "+e.className+" ").indexOf(" unrendered ")>-1?o.renderSequenceCallbacks[t+"-"+n+"-"+r]=u:u()},loadOpts:function(){return this.type("bed").loadOpts.apply(this,arguments)},saveOpts:function(){return this.type("bed").saveOpts.apply(this,arguments)}};t.exports=a},{"./utils/PairedIntervalTree.js":19,"./utils/RemoteTrack.js":20,"./utils/utils.js":22}],12:[function(e,t,n){var r=e("./utils/utils.js"),i=r.floorHack,s=r.parseInt10,o=e("./utils/IntervalTree.js").IntervalTree,u=e("./utils/LineMask.js").LineMask,a={defaults:{itemRgb:"off",colorByStrand:"",useScore:0,group:"user",priority:"user",offset:0,detail:!1,url:"",htmlUrl:"",drawLimit:{squish:null,pack:null}},init:function(){this.type().initOpts.call(this)},initOpts:function(){var e=this,t=e.opts.colorByStrand.split(/\s+/),n=t.length>1&&_.all(t,e.validateColor);e.opts.useScore=e.isOn(e.opts.useScore),e.opts.itemRgb=e.isOn(e.opts.itemRgb),n?e.opts.altColor=t[1]:(e.opts.colorByStrand="",e.opts.altColor=null)},parseLine:function(e,t){var n=["chrom","chromStart","chromEnd","name","score","strand","thickStart","thickEnd","itemRgb","blockCount","blockSizes","blockStarts","id","description"],r={},i=/\t/.test(e)?e.split("	"):e.split(/\s+/),o,u;return this.opts.detail&&(n[i.length-2]="id",n[i.length-1]="description"),_.each(i,function(e,t){r[n[t]]=e}),o=this.browserOpts.chrPos[r.chrom],t=t||0,_.isUndefined(o)?(this.warn("Invalid chromosome '"+r.chrom+"' at line "+(t+1+this.opts.lineNum)),null):(r.score=_.isUndefined(r.score)?"?":r.score,r.start=o+s(r.chromStart)+1,r.end=o+s(r.chromEnd)+1,r.blocks=null,/^\d+$/.test(r.thickStart)&&/^\d+$/.test(r.thickEnd)?(r.thickStart=o+s(r.thickStart)+1,r.thickEnd=o+s(r.thickEnd)+1,/^\d+(,\d*)*$/.test(r.blockSizes)&&/^\d+(,\d*)*$/.test(r.blockStarts)&&(r.blocks=[],u=r.blockSizes.split(/,/),_.each(r.blockStarts.split(/,/),function(e,t){if(e==="")return;var n={start:r.start+s(e)};n.end=n.start+s(u[t]),r.blocks.push(n)}))):r.thickStart=r.thickEnd=null,r)},parse:function(e){var t=this,n=t.browserOpts.genomeSize/2,r=new o(i(n),{startKey:"start",endKey:"end"});return _.each(e,function(e,n){var i=t.type().parseLine.call(t,e,n);i&&r.add(i)}),t.data=r,t.heights={max:null,min:15,start:15},t.sizes=["dense","squish","pack"],t.mapSizes=["pack"],!0},stackedLayout:function(e,t,n,r){r=_.isFunction(r)?r:function(){return};var i=[],s=_.max(_.map(e,function(e){return r(e.data)||0}))+1,o=_.sortBy(e,function(e){var t=r(e.data);return _.isUndefined(t)?1:-t});while(s-->0)i.push(new u(t,5));return _.each(o,function(e){var s=e.data,o=r(s),a=n(s),f=s.thickStart!==null&&n({start:s.thickStart,end:s.thickEnd}),l=s.blocks!==null&&_.map(s.blocks,n),c=0,h=i.length;if(!_.isUndefined(o))i[o].conflict(a.tx,a.tw),i[o].add(a.tx,a.tw,{pInt:a,thickInt:f,blockInts:l,d:s});else{while(c<h&&i[c].conflict(a.tx,a.tw))++c;c==h&&i.push(new u(t,5)),r(s,c),i[c].add(a.tx,a.tw,{pInt:a,thickInt:f,blockInts:l,d:s})}}),_.map(i,function(e){return _.pluck(e.items,"data")})},prerender:function(e,t,n,i,s){function c(e,t){var r=u+"_"+n;return _.isUndefined(t)?e.line&&e.line[r]:(e.line||(e.line={}),e.line[r]=t)}var o=i.width,u=(t-e)/o,a=this.data.search(e,t),f=[],l=new r.pixIntervalCalculator(e,o,u,n=="pack");return n=="dense"?_.each(a,function(e){var t=l(e.data);t.v=e.data.score,f.push(t)}):(f={layout:this.type("bed").stackedLayout.call(this,a,o,l,c)},f.width=o),_.isFunction(s)?s(f):f},addArea:function(e,t,n,r,i){var s={},o=this.type().tipTipData;if(!e)return;_.isFunction(o)?s=o(t):(_.isUndefined(t.d.description)||(s.description=t.d.description),_.isUndefined(t.d.score)||(s.score=t.d.score),_.extend(s,{position:t.d.chrom+":"+t.d.chromStart,size:t.d.chromEnd-t.d.chromStart}),!_.isUndefined(t.d.id)&&!/\t/.test(t.d.id)&&(s.id=t.d.id)),e.push([t.pInt.x,n*r+1,t.pInt.x+t.pInt.w,(n+1)*r,t.d.name||t.d.id||"",i.replace("$$",_.isUndefined(t.d.id)?t.d.name:t.d.id),t.pInt.oPrev,null,null,s])},calcAlpha:function(e){return Math.max(e,166)/1e3},calcGradient:function(e,t){var n=[230,230,230],r=[];return _.isArray(e)||(e=_.map(e.split(","),s)),_.each(n,function(n,i){r[i]=(n-e[i])*((1e3-t)/1e3)+e[i]}),_.map(r,s).join(",")},drawArrows:function(e,t,n,r,i,s,o){var u=Math.min(r,3),a,f;i=Math.max(i,0),s=Math.min(s,t);if(s-i<5)return;if(o!=="+"&&o!=="-")return;e.beginPath(),a=o=="+"?.5:u+.5,f=o=="+"?u+.5:.5;for(var l=Math.floor(i)+2;l<s-u;l+=7)e.moveTo(l+a,n+r-u+.5),e.lineTo(l+f,n+r+.5),e.lineTo(l+a,n+r+u+.5);e.stroke()},drawFeature:function(e,t,n,i,s){var o=this,u=o.opts.color,a=i*s,f=Math.round(.5*(s-1)),l=Math.ceil(.25*(s-1)),c=s>6?2:1,h=null,p=null;o.opts.altColor&&n.d.strand=="-"&&(u=o.opts.altColor),o.opts.itemRgb&&n.d.itemRgb&&this.validateColor(n.d.itemRgb)&&(u=n.d.itemRgb),o.opts.useScore&&(u=o.type("bed").calcGradient(u,n.d.score));if(o.opts.itemRgb||o.opts.altColor||o.opts.useScore)e.fillStyle=e.strokeStyle="rgb("+u+")";n.thickInt?n.blockInts?(p=null,e.fillRect(n.pInt.x,a+f,n.pInt.w,1),e.strokeStyle=u,_.each(n.blockInts,function(i){i.x+i.w<=t&&i.x>=0&&e.fillRect(i.x,a+f-l+1,i.w,l*2-1),h=r.pixIntervalOverlap(i,n.thickInt),h&&e.fillRect(h.x,a+1,h.w,s-c),n.d.strand&&p&&(e.strokeStyle="rgb("+u+")",o.type("bed").drawArrows(e,t,a,f,p.x+p.w,i.x,n.d.strand)),p=i}),n.blockInts.length==1&&(e.strokeStyle="white",o.type("bed").drawArrows(e,t,a,f,n.thickInt.x,n.thickInt.x+n.thickInt.w,n.d.strand))):(e.fillRect(n.pInt.x,a+f-l+1,n.pInt.w,l*2-1),e.fillRect(n.thickInt.x,a+1,n.thickInt.w,s-c),e.strokeStyle="white",o.type("bed").drawArrows(e,t,a,f,n.thickInt.x,n.thickInt.x+n.thickInt.w,n.d.strand)):(e.fillRect(n.pInt.x,a+1,n.pInt.w,s-c),e.strokeStyle="white",o.type("bed").drawArrows(e,t,a,f,n.pInt.x,n.pInt.x+n.pInt.w,n.d.strand))},drawSpec:function(e,t,n){var r=this,i=e.getContext&&e.getContext("2d"),s=r.opts.url?r.opts.url:'javascript:void("'+r.opts.name+':$$")',o=r.opts.drawLimit&&r.opts.drawLimit[n],u=n=="pack"?15:6,a=r.opts.color,f=null;if(!i)throw"Canvas not supported";n=="pack"&&!r.areas[e.id]&&(f=r.areas[e.id]=[]);if(n=="dense")e.height=15,i.fillStyle="rgb("+a+")",_.each(t,function(e){r.opts.useScore&&(i.fillStyle="rgba("+r.type("bed").calcGradient(a,e.v)+")"),i.fillRect(e.x,1,e.w,13)});else{if(o&&t.layout&&t.layout.length>o||t.tooMany){e.height=0,e.className=e.className+" too-many";return}e.height=t.layout.length*u,i.fillStyle=i.strokeStyle="rgb("+a+")",_.each(t.layout,function(e,n){_.each(e,function(e){r.type("bed").drawFeature.call(r,i,t.width,e,n,u),r.type("bed").addArea.call(r,f,e,n,u,s)})})}},render:function(e,t,n,r,i){var s=this;s.prerender(t,n,r,{width:e.width},function(t){s.type().drawSpec.call(s,e,t,r),_.isFunction(i)&&i()})},loadOpts:function(e){var t=this.opts,n=/\d+,\d+,\d+\s+\d+,\d+,\d+/.test(t.colorByStrand),r=n?t.colorByStrand.split(/\s+/)[1]:"0,0,0";e.find("[name=colorByStrandOn]").attr("checked",!!n),e.find("[name=colorByStrand]").val(r).change(),e.find("[name=useScore]").attr("checked",this.isOn(t.useScore)),e.find("[name=url]").val(t.url)},saveOpts:function(e){var t=this.opts,n=e.find("[name=colorByStrandOn]").is(":checked"),r=e.find("[name=colorByStrand]").val(),i=this.validateColor(r);t.colorByStrand=n&&i?t.color+" "+r:"",t.useScore=e.find("[name=useScore]").is(":checked")?1:0,t.url=e.find("[name=url]").val(),this.type("bed").initOpts.call(this)}};t.exports=a},{"./utils/IntervalTree.js":17,"./utils/LineMask.js":18,"./utils/utils.js":22}],13:[function(e,t,n){var r=e("./utils/utils.js"),i=r.parseInt10,s={defaults:{altColor:"",priority:100,autoScale:"on",alwaysZero:"off",gridDefault:"off",maxHeightPixels:"128:128:15",graphType:"bar",viewLimits:"",yLineMark:0,yLineOnOff:"off",windowingFunction:"maximum",smoothingWindow:"off"},init:function(){return this.type("wiggle_0").init.call(this)},_binFunctions:r.wigBinFunctions,initOpts:function(){return this.type("wiggle_0").initOpts.call(this)},applyOpts:function(){return this.type("wiggle_0").applyOpts.apply(this,arguments)},parse:function(e){var t=this,n=this.browserOpts.genomeSize,r={all:[]},s,o,u,a;return t.range=t.isOn(this.opts.alwaysZero)?[0,0]:[Infinity,-Infinity],_.each(e,function(e,n){var s=["chrom","chromStart","chromEnd","dataValue"],o={},u,a,f,l;_.each(e.split(/\s+/),function(e,t){o[s[t]]=e}),u=t.browserOpts.chrPos[o.chrom],_.isUndefined(u)&&t.warn("Invalid chromosome at line "+(n+1+t.opts.lineNum)),a=i(o.chromStart),f=i(o.chromEnd),l=parseFloat(o.dataValue),r.all.push({start:u+a,end:u+f,val:l})}),t.type("wiggle_0").finishParse.call(t,r)},initDrawSpec:function(){return this.type("wiggle_0").initDrawSpec.apply(this,arguments)},drawBars:function(){return this.type("wiggle_0").drawBars.apply(this,arguments)},prerender:function(e,t,n,r,i){return this.type("wiggle_0").prerender.call(this,e,t,n,r,i)},render:function(e,t,n,r,i){this.type("wiggle_0").render.call(this,e,t,n,r,i)},loadOpts:function(){return this.type("wiggle_0").loadOpts.apply(this,arguments)},saveOpts:function(){return this.type("wiggle_0").saveOpts.apply(this,arguments)}};t.exports=s},{"./utils/utils.js":22}],14:[function(e,t,n){var r=e("./utils/utils.js"),i=r.floorHack,s=e("./utils/IntervalTree.js").IntervalTree,o=e("./utils/RemoteTrack.js").RemoteTrack,u={defaults:{chromosomes:"",itemRgb:"off",colorByStrand:"",useScore:0,group:"user",priority:"user",offset:0,detail:!1,url:"",htmlUrl:"",drawLimit:{squish:500,pack:100},maxFetchWindow:0},init:function(){if(!this.opts.bigDataUrl)throw new Error("Required parameter bigDataUrl not found for bigBed track at "+JSON.stringify(this.opts)+(this.opts.lineNum+1))},parse:function(e){var t=this,n=t.browserOpts.genomeSize/2,r=new s(i(n),{startKey:"start",endKey:"end"}),u=t.ajaxDir()+"bigbed.php",a;return a=new o(r,function(e,n,r){range=t.chrRange(e,n),$.ajax(u,{data:{range:range,url:t.opts.bigDataUrl,density:"pack"},success:function(e){var n=_.filter(e.split("\n"),function(e){var t=e.match(/\t/g);return t&&t.length>=2}),i=_.map(n,function(e){var n=t.type("bed").parseLine.call(t,e);return _.isUndefined(n.id)&&(n.id=[n.name,n.chrom,n.chromStart,n.chromEnd,n.strand,n.blockCount].join("	")),n});r(i)}})}),t.data={cache:r,remote:a},t.heights={max:null,min:15,start:15},t.sizes=["dense","squish","pack"],t.mapSizes=["pack"],$.ajax(u,{data:{url:t.opts.bigDataUrl},success:function(e){if(!t.opts.maxFetchWindow){var n=e.itemCount/t.browserOpts.genomeSize,r=_.max(_.values(t.opts.drawLimit));t.opts.maxFetchWindow=r/n,t.opts.optimalFetchWindow=Math.floor(t.opts.maxFetchWindow/3)}a.setupBins(t.browserOpts.genomeSize,t.opts.optimalFetchWindow,t.opts.maxFetchWindow)}}),!0},prerender:function(e,t,n,i,s){function c(e,t){var r=f+"_"+n;return _.isUndefined(t)?e.line&&e.line[r]:(e.line||(e.line={}),e.line[r]=t)}function h(e){var t=[],n;n=e.split(/\s+/g),_.each(n,function(e,n){e!="n/a"&&e.length&&t.push({x:n,w:1,v:parseFloat(e)*1e3})}),s(t)}var o=this,u=i.width,a=o.data,f=(t-e)/u,l=this.chrRange(e,t);n!="dense"&&t-e>o.opts.maxFetchWindow?s({tooMany:!0}):n=="dense"?$.ajax(o.ajaxDir()+"bigbed.php",{data:{range:l,url:o.opts.bigDataUrl,width:u,density:n},success:h}):o.data.remote.fetchAsync(e,t,function(t){var i,a={};if(t.tooMany)return s(t);i=new r.pixIntervalCalculator(e,u,f,n=="pack"),a.layout=o.type("bed").stackedLayout.call(o,t,u,i,c),a.width=u,s(a)})},render:function(e,t,n,r,i){var s=this;s.prerender(t,n,r,{width:e.width},function(t){s.type("bed").drawSpec.call(s,e,t,r),_.isFunction(i)&&i()})},loadOpts:function(){return this.type("bed").loadOpts.apply(this,arguments)},saveOpts:function(){return this.type("bed").saveOpts.apply(this,arguments)}};t.exports=u},{"./utils/IntervalTree.js":17,"./utils/RemoteTrack.js":20,"./utils/utils.js":22}],15:[function(e,t,n){var r={defaults:{altColor:"128,128,128",priority:100,autoScale:"on",alwaysZero:"off",gridDefault:"off",maxHeightPixels:"128:128:15",graphType:"bar",viewLimits:"",yLineMark:0,yLineOnOff:"off",windowingFunction:"maximum",smoothingWindow:"off"},init:function(){if(!this.opts.bigDataUrl)throw new Error("Required parameter bigDataUrl not found for bigWig track at "+JSON.stringify(this.opts)+(this.opts.lineNum+1));this.type("wiggle_0").initOpts.call(this)},_binFunctions:{minimum:1,maximum:1,mean:1,min:1,max:1,std:1,coverage:1},applyOpts:function(){return this.type("wiggle_0").applyOpts.apply(this,arguments)},parse:function(e){var t=this;return t.stretchHeight=!0,t.range=t.isOn(t.opts.alwaysZero)?[0,0]:[Infinity,-Infinity],$.ajax(t.ajaxDir()+"bigwig.php",{data:{info:1,url:this.opts.bigDataUrl},async:!1,success:function(e){var n=e.split("\n");_.each(n,function(e){var n=e.split(": ");n[0]=="min"&&(t.range[0]=Math.min(parseFloat(n[1]),t.range[0])),n[0]=="max"&&(t.range[1]=Math.max(parseFloat(n[1]),t.range[1]))})}}),t.type("wiggle_0").applyOpts.apply(t),!0},prerender:function(e,t,n,r,i){function a(e){var t=s.type("wiggle_0").initDrawSpec.call(s,r),n=e.split(/\s+/g);_.each(n,function(e){e=="n/a"?t.bars.push(null):e.length&&t.bars.push((parseFloat(e)-s.drawRange[0])/t.vScale)}),i(t)}var s=this,o=r.width,u=s.chrRange(e,t);$.ajax(s.ajaxDir()+"bigwig.php",{data:{range:u,url:s.opts.bigDataUrl,width:o,winFunc:s.opts.windowingFunction},success:a})},render:function(e,t,n,r,i){var s=this,o=e.height,u=e.width,a=e.getContext&&e.getContext("2d");if(!a)throw"Canvas not supported";s.prerender(t,n,r,{width:u,height:o},function(e){s.type("wiggle_0").drawBars.call(s,a,e,o,u),_.isFunction(i)&&i()})},loadOpts:function(){return this.type("wiggle_0").loadOpts.apply(this,arguments)},saveOpts:function(){return this.type("wiggle_0").saveOpts.apply(this,arguments)}};t.exports=r},{}],16:[function(e,t,n){var r=e("./utils/IntervalTree.js").IntervalTree,i=e("./utils/utils.js"),s=i.strip,o=i.floorHack,u=i.parseInt10,a={defaults:{collapseByGene:"off",keyColumnWidth:21,itemRgb:"off",colorByStrand:"",useScore:0,group:"user",priority:"user",offset:0,url:"",htmlUrl:"",drawLimit:{squish:null,pack:null}},init:function(){this.type("bed").initOpts.call(this),this.opts.collapseByGene=this.isOn(this.opts.collapseByGene),this.featureTypeCounts={}},parseEntry:function(e,t,n){var r={chrom:e,score:"?",blocks:null,qualifiers:{}},i=this.opts.keyColumnWidth,o=null,a=[],f=["locus_tag","gene","db_xref"],l=["gene","locus_tag","db_xref"],c=["rrna","trna"],h=["product"],p,d,v;return d=this.browserOpts.chrPos[e],n=n||0,_.isUndefined(d)?(this.warn("Invalid chromosome at line "+(lineno+1+this.opts.lineNum)),null):(_.each(t,function(e,t){var n=e.substr(0,i),u=e.substr(i),f=u.match(/^\/(\w+)(=?)(.*)/);n.match(/\w/)?(r.type=s(n),o=null,a.push(u)):f?(o=f[1],r.qualifiers[o]||(r.qualifiers[o]=[]),r.qualifiers[o].push([f[2]?f[3]:!0])):o!==null?_.last(r.qualifiers[o]).push(u):a.push(u)}),r.fullLocation=a=a.join(""),p=_.map(_.filter(a.split(/\D+/),_.identity),u),r.chromStart=_.min(p),r.chromEnd=_.max(p)+1,r.start=d+r.chromStart,r.end=d+r.chromEnd,r.strand=/complement/.test(a)?"-":"+",r.thickStart=r.thickEnd=null,r.blocks=null,_.each(r.qualifiers,function(e,t){_.each(e,function(t,n){e[n]=s(t.join(" ")),/^"[\s\S]*"$/.test(e[n])&&(e[n]=e[n].replace(/^"|"$/g,"").replace(/""/g,'"'))})}),r.name=r.type,_.contains(c,r.type.toLowerCase())&&Array.prototype.push.apply(l,h),_.find(l,function(e){if(r.qualifiers[e]&&r.qualifiers[e][0])return r.name=r.qualifiers[e][0]}),r.name==r.type&&(this.featureTypeCounts[r.type]||(this.featureTypeCounts[r.type]=1),r.name=r.name+"_"+this.featureTypeCounts[r.type]++),this.opts.collapseByGene&&_.find(f,function(e){if(r.qualifiers[e]&&r.qualifiers[e][0])return r._collapseKey=r.qualifiers[e][0]}),r)},collapseFeatures:function(e){var t=this.browserOpts.chrPos,n=["mrna","gene","cds"],r=["exon","cds"],i=e[0],s=[],o,u,a;return o=_.find(n,function(t){var n=_.find(e,function(e){return e.type.toLowerCase()==t});if(n)return i=n,!0}),_.find(r,function(t){a=_.select(e,function(e){return e.type.toLowerCase()==t});if(a.length)return!0}),u=_.find(e,function(e){return e.type.toLowerCase()=="cds"}),_.each(a,function(e){e.fullLocation.replace(/(\d+)\.\.[><]?(\d+)/g,function(n,r,i){s.push({start:t[e.chrom]+Math.min(r,i),end:t[e.chrom]+Math.max(r,i)+1})})}),s.length&&(i.blocks=_.sortBy(s,function(e){return e.start}),i.thickStart=u?u.start:feature.start,i.thickEnd=u?u.end:feature.end),_.each(e,function(e){if(e===i)return;_.each(e.qualifiers,function(e,t){i.qualifiers[t]||(i.qualifiers[t]=[]),_.each(e,function(e){_.contains(i.qualifiers[t],e)||i.qualifiers[t].push(e)})})}),i},parse:function(e){function h(r){f!==null&&(c=t.type().parseEntry.call(t,a,e.slice(f,r),f),c&&(n.collapseByGene?(l[c._collapseKey]=l[c._collapseKey]||[],l[c._collapseKey].push(c)):s.add(c)))}var t=this,n=t.opts,i=this.browserOpts.genomeSize/2,s=new r(o(i),{startKey:"start",endKey:"end"}),u=e.length,a=null,f=null,l={},c;return _.each(e,function(e,t){e.substr(0,12)=="ACCESSION   "?(h(t),a=e.substr(12),f=null):a!==null&&e.substr(5,1).match(/\w/)&&(h(t),f=t)}),a!==null&&h(e.length),n.collapseByGene&&_.each(l,function(e,n){s.add(t.type().collapseFeatures.call(t,e))}),t.data=s,t.heights={max:null,min:15,start:15},t.sizes=["dense","squish","pack"],t.mapSizes=["pack"],!0},tipTipData:function(e){var t={translation:1},n={type:e.d.type,position:e.d.chrom+":"+e.d.chromStart,size:e.d.chromEnd-e.d.chromStart};return e.d.qualifiers.note&&e.d.qualifiers.note[0],_.each(e.d.qualifiers,function(e,r){if(r=="note"){n.description=e.join("; ");return}n[r]=e.join("; "),t[r]&&n[r].length>25&&(n[r]=n[r].substr(0,25)+"...")}),n},prerender:function(e,t,n,r,i){return this.type("bed").prerender.call(this,e,t,n,r,i)},drawSpec:function(){return this.type("bed").drawSpec.apply(this,arguments)},render:function(e,t,n,r,i){this.type("bed").render.call(this,e,t,n,r,i)},loadOpts:function(){return this.type("bed").loadOpts.apply(this,arguments)},saveOpts:function(){return this.type("bed").saveOpts.apply(this,arguments)}};t.exports=a},{"./utils/IntervalTree.js":17,"./utils/utils.js":22}],17:[function(e,t,n){(function(t){function r(e,t){t||(t={}),this.startKey=t.startKey||0,this.endKey=t.endKey||1,this.intervalHash={},this.pointTree=new n({compare:function(e,t){if(e==null)return-1;if(t==null)return 1;var n=e[0]-t[0];return n>0?1:n==0?0:-1}}),this._autoIncrement=0;if(!e||typeof e!="number")throw new Error("you must specify center index as the 2nd argument.");this.root=new a(e,this)}function i(e){return e>2147483647||e<-2147483648?Math.floor(e/2):e>>>1}function s(e,t){for(;;)if(t.end<e.idx)e.left||(e.left=new a(i(t.start+t.end),this)),e=e.left;else{if(!(e.idx<t.start))return e.insert(t);e.right||(e.right=new a(i(t.start+t.end),this)),e=e.right}}function o(e,t,n){for(;;){if(!e)break;if(t<e.idx)e.starts.arr.every(function(e){var r=e.start<=t;return r&&n.push(e.result()),r}),e=
e.left;else{if(!(t>e.idx)){e.starts.arr.map(function(e){n.push(e.result())});break}e.ends.arr.every(function(e){var r=e.end>=t;return r&&n.push(e.result()),r}),e=e.right}}}function u(e,t,n){if(t-e<=0)throw new Error("end must be greater than start. start: "+e+", end: "+t);var r={},s=[];o.call(this,this.root,i(e+t),s,!0),s.forEach(function(e){r[e.id]=!0});var u=this.pointTree.bsearch([e,null]);while(u>=0&&this.pointTree.arr[u][0]==e)u--;var a=this.pointTree.bsearch([t,null]),f=this.pointTree.arr.length-1;while(a==-1||a<=f&&this.pointTree.arr[a][0]<=t)a++;this.pointTree.arr.slice(u+1,a).forEach(function(e){var t=e[1];r[t]=!0},this),Object.keys(r).forEach(function(r){var i=this.intervalHash[r];n.push(i.result(e,t))},this)}function a(e){this.idx=e,this.starts=new n({compare:function(e,t){if(e==null)return-1;if(t==null)return 1;var n=e.start-t.start;return n>0?1:n==0?0:-1}}),this.ends=new n({compare:function(e,t){if(e==null)return-1;if(t==null)return 1;var n=e.end-t.end;return n<0?1:n==0?0:-1}})}function f(e,t,n,r){this.id=t,this.start=e[n],this.end=e[r],this.data=e;if(typeof this.start!="number"||typeof this.end!="number")throw new Error("start, end must be number. start: "+this.start+", end: "+this.end);if(this.start>=this.end)throw new Error("start must be smaller than end. start: "+this.start+", end: "+this.end)}function l(e){this.name="DuplicateError",this.message=e,this.stack=(new Error).stack}var n=e("./SortedList.js").SortedList;r.prototype.add=function(e,t){if(this.contains(t))throw new l("id "+t+" is already registered.");if(t==undefined){while(this.intervalHash[this._autoIncrement])this._autoIncrement++;t=this._autoIncrement}var n=new f(e,t,this.startKey,this.endKey);this.pointTree.insert([n.start,t]),this.pointTree.insert([n.end,t]),this.intervalHash[t]=n,this._autoIncrement++,s.call(this,this.root,n)},r.prototype.contains=function(e){return!!this.get(e)},r.prototype.get=function(e){return this.intervalHash[e]||null},r.prototype.addIfNew=function(e,t){try{this.add(e,t)}catch(n){if(n instanceof l)return;throw n}},r.prototype.search=function(e,t){var n=[];if(typeof e!="number")throw new Error(e+": invalid input");if(t==undefined)o.call(this,this.root,e,n);else{if(typeof t!="number")throw new Error(e+","+t+": invalid input");u.call(this,e,t,n)}return n},r.prototype.remove=function(e){throw".remove() is currently unimplemented"},a.prototype.insert=function(e){this.starts.insert(e),this.ends.insert(e)},f.prototype.result=function(e,t){var n={id:this.id,data:this.data};if(typeof e=="number"&&typeof t=="number"){var r=Math.max(this.start,e),i=Math.min(this.end,t),s=i-r;n.rate1=s/(t-e),n.rate2=s/(this.end-this.start)}return n},l.prototype=new Error,t.IntervalTree=r})(t&&t.exports||this)},{"./SortedList.js":21}],18:[function(e,t,n){(function(n){(function(t){function s(e,t){this.fudge=t=t||1,this.items=[],this.length=Math.ceil(e/t),this.mask=n.Uint8Array?new Uint8Array(this.length):new Array(this.length)}var r=e("./utils.js"),i=r.floorHack;s.prototype.add=function(e,t,n){var r=Math.ceil((e+t)/this.fudge);this.items.push({x:e,w:t,data:n});for(var s=Math.max(i(e/this.fudge),0);s<Math.min(r,this.length);s++)this.mask[s]=1},s.prototype.conflict=function(e,t){var n=Math.ceil((e+t)/this.fudge);for(var r=Math.max(i(e/this.fudge),0);r<Math.min(n,this.length);r++)if(this.mask[r])return!0;return!1},t.LineMask=s})(t&&t.exports||this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./utils.js":22}],19:[function(e,t,n){(function(t){function i(e,t,i){var s={startKey:0,endKey:1};this.unpaired=new n(e,t),this.unpairedOptions=r.extend({},s,t),this.paired=new n(e,i),this.pairedOptions=r.extend({pairingKey:"qname",pairedLengthKey:"tlen"},s,i);if(this.pairedOptions.startKey===this.unpairedOptions.startKey)throw new Error("startKey for unpairedOptions and pairedOptions must be different in a PairedIntervalTree");if(this.pairedOptions.endKey===this.unpairedOptions.endKey)throw new Error("endKey for unpairedOptions and pairedOptions must be different in a PairedIntervalTree");this.pairingDisabled=!1,this.pairingMinDistance=this.pairingMaxDistance=null}function s(e,t){return t.isSecondaryAlignment||t.isReadFailingVendorQC||t.isDuplicateRead||t.isSupplementaryAlignment?!1:!0}function o(e,t,n){var r=t.start>n.start,i=r?t.start-n.end:n.start-t.end;if(t.rnext!="="||n.rnext!="=")return!1;if(!t.isReadPaired||!n.isReadPaired)return!1;if(!t.isReadProperlyAligned||!n.isReadProperlyAligned)return!1;if(t.isReadUnmapped||n.isReadUnmapped)return!1;if(t.isMateUnmapped||n.isMateUnmapped)return!1;if(t.isReadFirstOfPair&&!n.isReadLastOfPair)return!1;if(t.isReadLastOfPair&&!n.isReadFirstOfPair)return!1;if(r){if(!t.readStrandReverse||t.mateStrandReverse)return!1;if(n.readStrandReverse||!n.mateStrandReverse)return!1}else{if(t.readStrandReverse||!t.mateStrandReverse)return!1;if(!n.readStrandReverse||n.mateStrandReverse)return!1}return i>this.pairingMaxDistance||i<this.pairingMinDistance?!1:!0}var n=e("./IntervalTree.js").IntervalTree,r=e("../../../underscore.min.js");i.prototype.disablePairing=function(){this.pairingDisabled=!0,this.paired=this.unpaired},i.prototype.setPairingInterval=function(e,t){if(typeof e!="number")throw new Error("you must specify min as the 1st argument.");if(typeof t!="number")throw new Error("you must specify max as the 2nd argument.");if(this.pairingMinDistance!==null)throw new Error("Can only be called once. You can't change the pairing interval.");this.pairingMinDistance=e,this.pairingMaxDistance=t},i.prototype.addIfNew=function(e,t){var n=!1,r=0,i=this.unpairedOptions.startKey,u=this.unpairedOptions.endKey,a=this.pairedOptions.startKey,f=this.pairedOptions.endKey,l=e[this.pairedOptions.pairedLengthKey],c,h;if(this.unpaired.contains(t))return;this.unpaired.add(e,t);if(!this.pairingDisabled&&s(this,e)){if(this.pairingMinDistance===null)throw new Error("Can only add paired data after the pairing interval has been set!");c=e[this.pairedOptions.pairingKey],h=this.paired.get(c),h!==null&&o(this,e,h)&&(e.mate=h,h.mate=e,n=!0);if(!n){while(this.paired.contains(c))c=c.replace(/\t.*/,"")+"	"+ ++r;l>0?(e[a]=e[i],e[f]=e[i]+l):l<0?(e[f]=e[u],e[a]=e[u]+l):(e[a]=e[i],e[f]=e[u]),this.paired.add(e,c)}}},i.prototype.add=i.prototype.addIfNew,i.prototype.search=function(e,t,n){return console.log(n),this.unpaired.search(e,t)},i.prototype.remove=function(e){throw".remove() is currently unimplemented"},t.PairedIntervalTree=i})(t&&t.exports||this)},{"../../../underscore.min.js":25,"./IntervalTree.js":17}],20:[function(e,t,n){(function(t){function s(e,t){if(typeof e!="object"||!e.addIfNew&&(!n.keys(e).length||e[n.keys(e)[0]].addIfNew))throw new Error("you must specify an IntervalTree cache, or an object/array containing IntervalTrees, as the 1st argument.");if(typeof t!="function")throw new Error("you must specify a fetcher function as the 2nd argument.");this.cache=e,this.fetcher=t,this.callbacks=[],this.afterBinSetup=[],this.binsLoaded=null}function o(e,t,r){if(!e.binsLoaded)throw new Error("you cannot calculate bin overlap before setupBins is called.");var i=Math.floor((t-1)/e.optimalFetchWindow),s=Math.floor((r-1)/e.optimalFetchWindow);return n.range(i,s+1)}function u(e,t,s){var o=t*e.optimalFetchWindow+1,u=(t+1)*e.optimalFetchWindow+1;e.binsLoaded[t]=r,e.fetcher(o,u,function(o){n.each(o,function(t){if(!t)return;e.cache.addIfNew(t,t.id)}),e.binsLoaded[t]=i,n.isFunction(s)&&s()})}function a(e){e.callbacks=n.filter(e.callbacks,function(t){var r=t.callback,s=n.isUndefined(t.extraArgs)?[]:t.extraArgs,u,a;return t.end-t.start>e.maxFetchWindow?(r({tooMany:!0}),!1):(u=o(e,t.start,t.end),a=n.filter(u,function(t){return e.binsLoaded[t]!==i}).length>0,a?!0:(r(e.cache.search.apply(e.cache,[t.start,t.end].concat(s))),!1))})}function f(e){e.callbacks=n.filter(e.callbacks,function(t){var n=t.callback;return t.end-t.start>e.maxFetchWindow?(n({tooMany:!0}),!1):!0})}var n=e("../../../underscore.min.js"),r=1,i=2;s.prototype.setupBins=function(e,t,r){var i=this;if(i.binsLoaded)throw new Error("you cannot run setupBins more than once.");if(typeof e!="number")throw new Error("you must specify the genomeSize as the 1st argument.");if(typeof t!="number")throw new Error("you must specify optimalFetchWindow as the 2nd argument.");if(typeof r!="number")throw new Error("you must specify maxFetchWindow as the 3rd argument.");i.genomeSize=e,i.optimalFetchWindow=t,i.maxFetchWindow=r,i.numBins=Math.ceil(e/t),i.binsLoaded={},n.each(this.afterBinSetup,function(e){i.fetchAsync(e.start,e.end,e.extraArgs)}),f(i)},s.prototype.fetchAsync=function(e,t,r,s){var f=this;n.isFunction(r)&&n.isUndefined(s)&&(s=r,r=undefined);if(!f.binsLoaded)n.isFunction(s)&&f.callbacks.push({start:e,end:t,extraArgs:r,callback:s}),f.afterBinSetup.push({start:e,end:t,extraArgs:r});else{var l=o(f,e,t),c=n.filter(l,function(e){return f.binsLoaded[e]===i}),h=n.filter(l,function(e){return!f.binsLoaded[e]});if(c.length==l.length)return r=n.isUndefined(r)?[]:r,n.isFunction(s)&&s(f.cache.search.apply(f.cache,[e,t].concat(r)));if(t-e>f.maxFetchWindow)return n.isFunction(s)&&s({tooMany:!0});n.isFunction(s)&&f.callbacks.push({start:e,end:t,extraArgs:r,callback:s}),n.each(h,function(e){u(f,e,function(){a(f)})})}},t.RemoteTrack=s})(t&&t.exports||this)},{"../../../underscore.min.js":25}],21:[function(e,t,n){(function(e){function t(){var e=null,n={},r=arguments;["0","1"].forEach(function(t){var i=r[t];Array.isArray(i)?e=i:i&&typeof i=="object"&&(n=i)}),this.arr=[],["filter","compare"].forEach(function(e){typeof n[e]=="function"?this[e]=n[e]:n[e]&&t[e][n[e]]&&(this[e]=t[e][n[e]])},this),e&&this.massInsert(e)}t.prototype.bsearch=function(e){var t,n=0,r=this.arr.length;while(r-n>1){t=Math.floor((n+r)/2),mval=this.arr[t];switch(this.compare(e,mval)){case 1:default:n=t;break;case-1:r=t;break;case 0:return t}}return this.arr[0]==null||n==0&&this.arr[0]!=null&&this.compare(this.arr[0],e)==1?-1:n},t.prototype.get=function(e){return this.arr[e]},t.prototype.toArray=function(e){return this.arr.slice()},t.prototype.slice=function(){return this.arr.slice.apply(this.arr,arguments)},t.prototype.size=function(){return this.arr.length},t.prototype.head=function(){return this.arr[0]},t.prototype.tail=function(){return this.arr.length==0?null:this.arr[this.arr.length-1]},t.prototype.massInsert=function(e){for(var t=0;t<e.length;t+=4096)Array.prototype.push.apply(this.arr,Array.prototype.slice.call(e,t,t+4096));this.arr.sort(this.compare)},t.prototype.insert=function(){arguments.length>100?this.massInsert(arguments):Array.prototype.forEach.call(arguments,function(e){var t=this.bsearch(e);this.filter(e,t)&&this.arr.splice(t+1,0,e)},this)},t.prototype.filter=function(e,t){return!0},t.prototype.add=t.prototype.insert,t.prototype["delete"]=function(e){this.arr.splice(e,1)},t.prototype.remove=t.prototype["delete"],t.prototype.massRemove=function(e,t){this.arr.splice(e,t)},t.compare={number:function(e,t){var n=e-t;return n>0?1:n==0?0:-1},string:function(e,t){return e>t?1:e==t?0:-1}},t.prototype.compare=t.compare.number,e.SortedList=t})(t&&t.exports||this)},{}],22:[function(e,t,n){var r=e("../../../underscore.min.js");t.exports.parseDeclarationLine=function(e,t){function u(e){o="optname",n[r.replace(/^\s+|\s+$/g,"")]=s,r=s=""}var n={},r="",s="",o="optname";for(i=e.match(t)[0].length;i<e.length;i++)c=e[i],o=="optname"?c=="="?o="startvalue":r+=c:o=="startvalue"?/'|"/.test(c)?o=c:(s+=c,o="value"):o=="value"?/\s/.test(c)?u():s+=c:/'|"/.test(o)&&(c==o?u(o):s+=c);return o=="value"&&u(),o!="optname"?!1:n},t.exports.pixIntervalCalculator=function(e,t,n,i,s,o,u){return r.isFunction(s)||(s=function(e){return e.name||""}),r.isUndefined(o)&&(o="start"),r.isUndefined(u)&&(u="end"),function(r){var a={x:Math.round((r[o]-e)/n),w:Math.round((r[u]-r[o])/n)+1,t:0,oPrev:!1,oNext:!1};return a.tx=a.x,a.tw=a.w,a.x<0?(a.w+=a.x,a.x=0,a.oPrev=!0):i&&(a.t=Math.min(s(r).length*10+2,a.x),a.tx-=a.t,a.tw+=a.t),a.x+a.w>t&&(a.w=t-a.x,a.oNext=!0),a}},t.exports.pixIntervalOverlap=function(e,t){var n={},r;return e.x>t.x&&(r=t,t=e,e=r),!e.w||!t.w||e.x+e.w<t.x?null:(n.x=t.x,n.w=Math.min(e.w-t.x+e.x,t.w),n)},t.exports.wigBinFunctions={minimum:function(e){return e.length?Math.min.apply(Math,e):0},mean:function(e){return r.reduce(e,function(e,t){return e+t},0)/e.length},maximum:function(e){return e.length?Math.max.apply(Math,e):0}},t.exports.floorHack=function(e){return(e<<0)-(e<0?1:0)},t.exports.strip=function(e){return e.replace(/^\s+|\s+$/g,"")},t.exports.parseInt10=function(e){return parseInt(e,10)}},{"../../../underscore.min.js":25}],23:[function(e,t,n){var r=e("./utils/utils.js"),i=r.parseInt10,s={defaults:{priority:100,drawLimit:{squish:500,pack:100},maxFetchWindow:1e5,chromosomes:""},init:function(){if(!this.opts.bigDataUrl)throw new Error("Required parameter bigDataUrl not found for vcfTabix track at "+JSON.stringify(this.opts)+(this.opts.lineNum+1))},parse:function(e){var t=this;return t.heights={max:null,min:15,start:15},t.sizes=["dense","squish","pack"],t.mapSizes=["pack"],!0},prerender:function(e,t,n,s,o){function h(e){var t=e.split("	"),n={},r={};return t[7]&&_.each(t[7].split(";"),function(e){e=e.split("="),e.length>1&&(r[e[0]]=e[1])}),n.start=u.browserOpts.chrPos[t[0]]+i(t[1]),n.id=t[2]=="."?"vcf-"+Math.floor(Math.random()*1e8):t[2],n.end=n.start+1,n.ref=t[3],n.alt=t[4],n.qual=parseFloat(t[5]),n.info=r,{data:n}}function p(e){var t=e.ref||"",n=e.alt||"";return(t.length>n.length?t:n)||""}function d(t){var i=[],s=_.filter(t.split("\n"),function(e){var t=e.match(/\t/g);return t&&t.length>8}),f=new r.pixIntervalCalculator(e,a,l,n=="pack",p);n=="dense"?_.each(s,function(e){i.push(f(h(e).data))}):(i={layout:u.type("bed").stackedLayout(_.map(s,h),a,f)},i.width=a),o(i)}var u=this,a=s.width,f=u.data,l=(t-e)/a,c=this.chrRange(e,t);t-e>u.opts.maxFetchWindow?o({tooMany:!0}):$.ajax(this.ajaxDir()+"tabix.php",{data:{range:c,url:this.opts.bigDataUrl},success:d})},render:function(e,t,n,r,i){var s=e.getContext&&e.getContext("2d"),o=this.opts.url?this.opts.url:'javascript:void("'+this.opts.name+':$$")',u=r=="pack"?27:6,a={a:"255,0,0",t:"255,0,255",c:"0,0,255",g:"0,255,0"},f=this.opts.drawLimit&&this.opts.drawLimit[r],l=null;if(!s)throw"Canvas not supported";r=="pack"&&(l=this.areas[e.id]=[]),s.fillStyle="rgb(0,0,0)",this.prerender(t,n,r,{width:e.width},function(t){f&&t.length>f||t.tooMany?(e.height=0,e.className=e.className+" too-many"):r=="dense"?(e.height=15,_.each(t,function(e){s.fillRect(e.x,1,e.w,13)})):(e.height=t.layout.length*u,_.each(t.layout,function(e,t){_.each(e,function(e){var n,r;l&&(r=a[e.d.ref.toLowerCase()]||"255,0,0",n=a[e.d.alt.toLowerCase()]||"255,0,0",s.fillStyle="rgb("+n+")"),s.fillRect(e.pInt.x,t*u+1,e.pInt.w,u-1),l&&l.push([e.pInt.x,t*u+1,e.pInt.x+e.pInt.w,(t+1)*u,e.d.ref+" > "+e.d.alt,o.replace("$$",e.d.id),e.pInt.oPrev,n,'<span style="color: rgb('+r+')">'+e.d.ref+"</span><br/>"+e.d.alt,e.d.info])})})),_.isFunction(i)&&i()})}};t.exports=s},{"./utils/utils.js":22}],24:[function(e,t,n){(function(n){var r=e("./utils/utils.js"),i=r.parseInt10,s=r.parseDeclarationLine,o=e("./utils/SortedList.js").SortedList,u={defaults:{altColor:"",priority:100,autoScale:"on",alwaysZero:"off",gridDefault:"off",maxHeightPixels:"128:128:15",graphType:"bar",viewLimits:"",yLineMark:0,yLineOnOff:"off",windowingFunction:"maximum",smoothingWindow:"off"},init:function(){this.type().initOpts.call(this)},_binFunctions:r.wigBinFunctions,initOpts:function(){var e=this.opts,t=this.type()._binFunctions;this.validateColor(e.altColor)||(e.altColor=""),e.viewLimits=_.map(e.viewLimits.split(":"),parseFloat),e.maxHeightPixels=_.map(e.maxHeightPixels.split(":"),i),e.yLineOnOff=this.isOn(e.yLineOnOff),e.yLineMark=parseFloat(e.yLineMark),e.autoScale=this.isOn(e.autoScale);if(t&&!t[e.windowingFunction])throw new Error("invalid windowingFunction at line "+e.lineNum);_.isNaN(e.yLineMark)&&(e.yLineMark=0)},applyOpts:function(){var e=this,t=e.opts;e.drawRange=t.autoScale||t.viewLimits.length<2?e.range:t.viewLimits,_.each({max:0,min:2,start:1},function(n,r){e.heights[r]=t.maxHeightPixels[n]});if(!t.altColor){var n=this.rgbToHsl.apply(this,t.color.split(/,\s*/g));n[0]=n[0]+.02,n[1]=n[1]*.7,n[2]=1-(1-n[2])*.7,e.altColor=_.map(this.hslToRgb.apply(this,n),i).join(",")}},parse:function(e){var t=this,n=this.browserOpts.genomeSize,r={all:[]},o,u,a,f;return t.range=t.isOn(this.opts.alwaysZero)?[0,0]:[Infinity,-Infinity],_.each(e,function(e,n){var l,c;f=e.match(/^(variable|fixed)Step\s+/i);if(f){o=f[1].toLowerCase(),u=s(e,/^(variable|fixed)Step\s+/i),u.start=i(u.start);if(o=="fixed"&&(_.isNaN(u.start)||!u.start))throw new Error("fixedStep at line "+(n+1+t.opts.lineNum)+" require non-zero start parameter");u.step=i(u.step);if(o=="fixed"&&(_.isNaN(u.step)||!u.step))throw new Error("fixedStep at line "+(n+1+t.opts.lineNum)+" require non-zero step parameter");u.span=i(u.span)||1,a=t.browserOpts.chrPos[u.chrom],_.isUndefined(a)&&t.warn("Invalid chromosome at line "+(n+1+t.opts.lineNum))}else{if(!o)throw new Error("Wiggle format at "+(n+1+t.opts.lineNum)+" has no preceding mode declaration");if(!_.isUndefined(a))if(o=="fixed")l=parseFloat(e),r.all.push({start:a+u.start,end:a+u.start+u.span,val:l}),u.start+=u.step;else{e=e.split(/\s+/);if(e.length<2)throw new Error("variableStep at line "+(n+1+t.opts.lineNum)+" requires two values per line");c=i(e[0]),l=parseFloat(e[1]),r.all.push({start:a+c,end:a+c+u.span,val:l})}}}),t.type().finishParse.call(t,r)},finishParse:function(e){var t=this,r=t.type()._binFunctions[t.opts.windowingFunction];return e.all.length>0&&(t.range[0]=_.min(e.all,function(e){return e.val}).val,t.range[1]=_.max(e.all,function(e){return e.val}).val),e.all=new o(e.all,{compare:function(e,t){if(e===null)return-1;if(t===null)return 1;var n=e.start-t.start;return n>0?1:n===0?0:-1}}),_.each(t.browserOpts.bppps,function(i){if(t.browserOpts.genomeSize/i>1e6)return;var s=Math.ceil(t.browserOpts.genomeSize/i),o=e[i]=n.Float32Array?new Float32Array(s):new Array(s),u=0,a=e.all.get(0),f,l;for(var c=0;c<s;c++){f=a&&a.start<=c*i&&a.end>c*i?[a.val]:[];while((l=e.all.get(u+1))&&l.start<(c+1)*i&&l.end>c*i)f.push(l.val),++u,a=l;o[c]=r(f)}e._binFunction=t.opts.windowingFunction}),t.data=e,t.stretchHeight=!0,t.type("wiggle_0").applyOpts.apply(t),!0},initDrawSpec:function(e){var t=(this.drawRange[1]-this.drawRange[0])/e.height,n={bars:[],vScale:t,yLine:this.isOn(this.opts.yLineOnOff)?Math.round((this.opts.yLineMark-this.drawRange[0])/t):null,zeroLine:-this.drawRange[0]/t};return n},prerender:function(e,t,n,r,i){var s=this,o=(t-e)/r.width,u=s.type().initDrawSpec.call(s,r),a=s.type()._binFunctions[s.opts.windowingFunction],f;if(s.data._binFunction==s.opts.windowingFunction&&(f=s.data[o]))u.bars=_.map(_.range((e-1)/o,(t-1)/o),function(e,t){return((f[e]||0)-s.drawRange[0])/u.vScale});else{var l=s.data.all.bsearch({start:e}),c=s.data.all.get(l),h,p;for(var d=0;d<r.width;d++){p=c&&c.end>=d*o+e?[c.val]:[];while((h=s.data.all.get(l+1))&&h.start<(d+1)*o+e&&h.end>=d*o+e)p.push(h.val),++l,c=h;u.bars.push((a(p)-s.drawRange[0])/u.vScale)}}return _.isFunction(i)?i(u):u},drawBars:function(e,t,n,r){var i=t.zeroLine,s="rgb("+this.opts.color+")",o="rgb("+(this.opts.altColor||this.altColor)+")",u=this.opts.graphType==="points";e.fillStyle=s,_.each(t.bars,function(t,r){if(t===null)return;t>i?u?e.fillRect(r,n-t,1,1):e.fillRect(r,n-t,1,i>0?t-i:t):(e.fillStyle=o,u?e.fillRect(r,i-t-1,1,1):e.fillRect(r,n-i,1,i-t),e.fillStyle=s)}),t.yLine!==null&&(e.fillStyle="rgb(0,0,0)",e.fillRect(0,n-t.yLine,r,1))},render:function(e,t,n,r,i){var s=this,o=e.height,u=e.width,a=e.getContext&&e.getContext("2d");if(!a)throw"Canvas not supported";s.prerender(t,n,r,{width:u,height:o},function(e){s.type().drawBars.call(s,a,e,o,u),_.isFunction(i)&&i()})},loadOpts:function(e){var t=this.opts,n=e.find(".view-limits"),r=e.find(".max-height-pixels"),i=this.validateColor(t.altColor);e.find("[name=altColorOn]").attr("checked",i).change(),e.find("[name=altColor]").val(i?t.altColor:"128,128,128").change(),e.find("[name=autoScale]").attr("checked",!this.isOn(t.autoScale)).change(),n.slider("option","min",this.range[0]),n.slider("option","max",this.range[1]),e.find("[name=viewLimitsMin]").val(this.drawRange[0]).change(),e.find("[name=viewLimitsMax]").val(this.drawRange[1]).change(),e.find("[name=yLineOnOff]").attr("checked",this.isOn(t.yLineOnOff)).change(),e.find("[name=yLineMark]").val(t.yLineMark).change(),e.find("[name=graphType]").val(t.graphType).change(),e.find("[name=windowingFunction]").val(t.windowingFunction).change(),e.find("[name=maxHeightPixelsOn]").attr("checked",t.maxHeightPixels.length>=3),e.find("[name=maxHeightPixelsMin]").val(t.maxHeightPixels[2]).change(),e.find("[name=maxHeightPixelsMax]").val(t.maxHeightPixels[0]).change()},saveOpts:function(e){var t=this.opts,n=e.find("[name=altColorOn]").is(":checked"),r=e.find("[name=maxHeightPixelsOn]").is(":checked"),i=e.find("[name=maxHeightPixelsMax]").val();t.altColor=n?e.find("[name=altColor]").val():"",t.autoScale=!e.find("[name=autoScale]").is(":checked"),t.viewLimits=e.find("[name=viewLimitsMin]").val()+":"+e.find("[name=viewLimitsMax]").val(),t.yLineOnOff=e.find("[name=yLineOnOff]").is(":checked"),t.yLineMark=e.find("[name=yLineMark]").val(),t.graphType=e.find("[name=graphType]").val(),t.windowingFunction=e.find("[name=windowingFunction]").val(),t.maxHeightPixels=r?[i,i,e.find("[name=maxHeightPixelsMin]").val()].join(":"):"",this.type("wiggle_0").initOpts.call(this)}};t.exports=u}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./utils/SortedList.js":21,"./utils/utils.js":22}],25:[function(e,t,n){(function(){function e(t,n,r){if(t===n)return t!==0||1/t==1/n;if(t==null||n==null)return t===n;t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped);if(t.isEqual&&T.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&T.isFunction(n.isEqual))return n.isEqual(t);var i=c.call(t);if(i!=c.call(n))return!1;switch(i){case"[object String]":return t==String(n);case"[object Number]":return t!=+t?n!=+n:t==0?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if(typeof t!="object"||typeof n!="object")return!1;for(var s=r.length;s--;)if(r[s]==t)return!0;r.push(t);var s=0,o=!0;if(i=="[object Array]"){if(s=t.length,o=s==n.length)for(;s--;)if(!(o=s in t==s in n&&e(t[s],n[s],r)))break}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var u in t)if(h.call(t,u)&&(s++,!(o=h.call(n,u)&&e(t[u],n[u],r))))break;if(o){for(u in n)if(h.call(n,u)&&!(s--))break;o=!s}}return r.pop(),o}var r=this,i=r._,s={},o=Array.prototype,u=Object.prototype,a=o.slice,f=o.concat,l=o.unshift,c=u.toString,h=u.hasOwnProperty,p=o.forEach,d=o.map,v=o.reduce,m=o.reduceRight,g=o.filter,y=o.every,b=o.some,w=o.indexOf,E=o.lastIndexOf,u=Array.isArray,S=Object.keys,x=Function.prototype.bind,T=function(e){return new A(e)};typeof n!="undefined"?(typeof t!="undefined"&&t.exports&&(n=t.exports=T),n._=T):typeof define=="function"&&define.amd?define("underscore",function(){return T}):r._=T,T.VERSION="1.2.3";var N=T.each=T.forEach=function(e,t,n){if(e!=null)if(p&&e.forEach===p)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,i=e.length;r<i;r++)if(r in e&&t.call(n,e[r],r,e)===s)break}else for(r in e)if(h.call(e,r)&&t.call(n,e[r],r,e)===s)break};T.map=function(e,t,n){var r=[];return e==null?r:d&&e.map===d?e.map(t,n):(N(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)},T.reduce=T.foldl=T.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(v&&e.reduce===v)return r&&(t=T.bind(t,r)),i?e.reduce(t,n):e.reduce(t);N(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.reduceRight=T.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(m&&e.reduceRight===m)return r&&(t=T.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=T.toArray(e).reverse();return r&&!i&&(t=T.bind(t,r)),i?T.reduce(s,t,n,r):T.reduce(s,t)},T.find=T.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},T.filter=T.select=function(e,t,n){var r=[];return e==null?r:g&&e.filter===g?e.filter(t,n):(N(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},T.reject=function(e,t,n){var r=[];return e==null?r:(N(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},T.every=T.all=function(e,t,n){var r=!0;return e==null?r:y&&e.every===y?e.every(t,n):(N(e,function(e,i,o){if(!(r=r&&t.call(n,e,i,o)))return s}),r)};var C=T.some=T.any=function(e,t,n){t||(t=T.identity);var r=!1;return e==null?r:b&&e.some===b?e.some(t,n):(N(e,function(e,i,o){if(r||(r=t.call(n,e,i,o)))return s}),!!r)};T.include=T.contains=function(e,t){var n=!1;return e==null?n:w&&e.indexOf===w?e.indexOf(t)!=-1:n=C(e,function(e){return e===t})},T.invoke=function(e,t){var n=a.call(arguments,2);return T.map(e,function(e){return(t.call?t||e:e[t]).apply(e,n)})},T.pluck=function(e,t){return T.map(e,function(e){return e[t]})},T.max=function(e,t,n){if(!t&&T.isArray(e))return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-Infinity;var r={computed:-Infinity};return N(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i>=r.computed&&(r={value:e,computed:i})}),r.value},T.min=function(e,t,n){if(!t&&T.isArray(e))return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return Infinity;var r={computed:Infinity};return N(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i<r.computed&&(r={value:e,computed:i})}),r.value},T.shuffle=function(e){var t=[],n;return N(e,function(e,r){r==0?t[0]=e:(n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e)}),t},T.sortBy=function(e,t,n){return T.pluck(T.map(e,function(e,r,i){return{value:e,criteria:t.call(n,e,r,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0}),"value")},T.groupBy=function(e,t){var n={},r=T.isFunction(t)?t:function(e){return e[t]};return N(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},T.sortedIndex=function(e,t,n){n||(n=T.identity);for(var r=0,i=e.length;r<i;){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},T.toArray=function(e){return e?e.toArray?e.toArray():T.isArray(e)?a.call(e):T.isArguments(e)?a.call(e):T.values(e):[]},T.size=function(e){return T.toArray(e).length},T.first=T.head=function(e,t,n){return t!=null&&!n?a.call(e,0,t):e[0]},T.initial=function(e,t,n){return a.call(e,0,e.length-(t==null||n?1:t))},T.last=function(e,t,n){return t!=null&&!n?a.call(e,Math.max(e.length-t,0)):e[e.length-1]},T.rest=T.tail=function(e,t,n){return a.call(e,t==null||n?1:t)},T.compact=function(e){return T.filter(e,function(e){return!!e})},T.flatten=function(e,t){return T.reduce(e,function(e,n){return T.isArray(n)?e.concat(t?n:T.flatten(n)):(e[e.length]=n,e)},[])},T.without=function(e){return T.difference(e,a.call(arguments,1))},T.uniq=T.unique=function(e,t,n){var n=n?T.map(e,n):e,r=[];return T.reduce(n,function(n,i,s){if(0==s||(t===!0?T.last(n)!=i:!T.include(n,i)))n[n.length]=i,r[r.length]=e[s];return n},[]),r},T.union=function(){return T.uniq(T.flatten(arguments,!0))},T.intersection=T.intersect=function(e){var t=a.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.indexOf(t,e)>=0})})},T.difference=function(e){var t=T.flatten(a.call(arguments,1));return T.filter(e,function(e){return!T.include(t,e)})},T.zip=function(){for(var e=a.call(arguments),t=T.max(T.pluck(e,"length")),n=Array(t),r=0;r<t;r++)n[r]=T.pluck(e,""+r);return n},T.indexOf=function(e,t,n){if(e==null)return-1;var r;if(n)return n=T.sortedIndex(e,t),e[n]===t?n:-1;if(w&&e.indexOf===w)return e.indexOf(t);for(n=0,r=e.length;n<r;n++)if(n in e&&e[n]===t)return n;return-1},T.lastIndexOf=function(e,t){if(e==null)return-1;if(E&&e.lastIndexOf===E)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},T.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0);for(var n=arguments[2]||1,r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);i<r;)s[i++]=e,e+=n;return s};var k=function(){};T.bind=function(e,t){var n,r;if(e.bind===x&&x)return x.apply(e,a.call(arguments,1));if(!T.isFunction(e))throw new TypeError;return r=a.call(arguments,2),n=function(){if(this instanceof n){k.prototype=e.prototype;var i=new k,s=e.apply(i,r.concat(a.call(arguments)));return Object(s)===s?s:i}return e.apply(t,r.concat(a.call(arguments)))}},T.bindAll=function(e){var t=a.call(arguments,1);return t.length==0&&(t=T.functions(e)),N(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var n={};return t||(t=T.identity),function(){var r=t.apply(this,arguments);return h.call(n,r)?n[r]:n[r]=e.apply(this,arguments)}},T.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(e,n)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(a.call(arguments,1)))},T.throttle=function(e,t){var n,r,i,s,o,u=T.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var a;i||(i=setTimeout(function(){i=null,o&&e.apply(n,r),u()},t)),s?o=!0:e.apply(n,r),u(),s=!0}},T.debounce=function(e,t){var n;return function(){var r=this,i=arguments;clearTimeout(n),n=setTimeout(function(){n=null,e.apply(r,i)},t)}},T.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},T.wrap=function(e,t){return function(){var n=f.apply([e],arguments);return t.apply(this,n)}},T.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},T.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},T.keys=S||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[],n;for(n in e)h.call(e,n)&&(t[t.length]=n);return t},T.values=function(e){return T.map(e,T.identity)},T.functions=T.methods=function(e){var t=[],n;for(n in e)T.isFunction(e[n])&&t.push(n);return t.sort()},T.extend=function(e){return N(a.call(arguments,1),function(t){for(var n in t)t[n]!==void 0&&(e[n]=t[n])}),e},T.defaults=function(e){return N(a.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e},T.isEqual=function(t,n){return e(t,n,[])},T.isEmpty=function(e){if(T.isArray(e)||T.isString(e))return e.length===0;for(var t in e)if(h.call(e,t))return!1;return!0},T.isElement=function(e){return!!e&&e.nodeType==1},T.isArray=u||function(e){return c.call(e)=="[object Array]"},T.isObject=function(e){return e===Object(e)},T.isArguments=function(e){return c.call(e)=="[object Arguments]"},T.isArguments(arguments)||(T.isArguments=function(e){return!!e&&!!h.call(e,"callee")}),T.isFunction=function(e){return c.call(e)=="[object Function]"},T.isString=function(e){return c.call(e)=="[object String]"},T.isNumber=function(e){return c.call(e)=="[object Number]"},T.isNaN=function(e){return e!==e},T.isBoolean=function(e){return e===!0||e===!1||c.call(e)=="[object Boolean]"},T.isDate=function(e){return c.call(e)=="[object Date]"},T.isRegExp=function(e){return c.call(e)=="[object RegExp]"},T.isNull=function(e){return e===null},T.isUndefined=function(e){return e===void 0},T.noConflict=function(){return r._=i,this},T.identity=function(e){return e},T.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},T.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},T.mixin=function(e){N(T.functions(e),function(t){M(t,T[t]=e[t])})};var L=0;T.uniqueId=function(e){var t=L++;return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},T.template=function(e,t){var n=T.templateSettings,n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(n.escape,function(e,t){return"',_.escape("+t.replace(/\\'/g,"'")+"),'"}).replace(n.interpolate,function(e,t){return"',"+t.replace(/\\'/g,"'")+",'"}).replace(n.evaluate||null,function(e,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",r=new Function("obj","_",n);return t?r(t,T):function(e){return r.call(this,e,T)}};var A=function(e){this._wrapped=e};T.prototype=A.prototype;var O=function(e,t){return t?T(e).chain():e},M=function(e,t){A.prototype[e]=function(){var e=a.call(arguments);return l.call(e,this._wrapped),O(t.apply(T,e),this._chain)}};T.mixin(T),N("pop,push,reverse,shift,sort,splice,unshift".split(","),function(e){var t=o[e];A.prototype[e]=function(){return t.apply(this._wrapped,arguments
),O(this._wrapped,this._chain)}}),N(["concat","join","slice"],function(e){var t=o[e];A.prototype[e]=function(){return O(t.apply(this._wrapped,arguments),this._chain)}}),A.prototype.chain=function(){return this._chain=!0,this},A.prototype.value=function(){return this._wrapped}}).call(this)},{}]},{},[2]);